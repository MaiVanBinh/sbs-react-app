import{d as W,e as K,a5 as Y,k,V as z,W as J,o as Q,ai as X,a as n,c as u,Y as c,a0 as y,j as a,G as p,a1 as L,aj as E,a2 as I,K as v,F as R,C as G,h as Z,eL as ee,ew as oe,ah as V}from"./index-eLyz9_Ts.js";import{u as se}from"./app-auth-7aW1ROCy.js";import{_ as te}from"./PageLoader.vue_vue_type_script_setup_true_lang-ZvbvX14z.js";import{u as re}from"./group-jQnorhMh.js";import{A as l}from"./app-authority-code-Q9MU7mjP.js";const ae={class:"h-full"},ie={class:"space-x-10 flex justify-between items-center"},ne={class:"flex-1 flex items-center space-x-10"},ce={class:"text-xl text-gray-500"},de={class:"flex-1 flex space-x-5"},ue={class:"flex space-x-1.5"},le={key:0},pe={key:1,class:"overflow-auto grid grid-rows-2 grid-flow-col gap-4 dark:text-dark-gray-200"},me={class:"border-b dark:border-dark-border p-3 text-center mb-2"},fe={class:"space-x-1 flex items-center"},Ee=W({__name:"AdminUserGroupEdit",props:{id:{default:0}},setup(U){const C=U,D=K(),{t:m}=Y(),S=se(),T=re(),{fetchGroup:B,updateGroup:O}=T,{fetchAppAuth:$}=S,h=k(!1),f=z({groupName:""}),j={groupName:{required:!0,message:"그룹명은 필수 입력 값입니다."}},{pass:b,errorFields:A}=J(f,j),g=k(),_=k([]),q=(o,t)=>{let e="";switch(o.groupId){case 2:e=l.ARTICLE_READ.code;break;case 3:e=l.CUESHEET_READ.code;break;case 5:e=l.CUESHEET_TEMPLATE_READ.code;break;case 6:e=l.REPORT_READ.code;break;case 7:e=l.MONITORING_READ.code;break;case 8:e=l.BOARD_READ.code;break;case 9:e=l.SCROLLNEWS_READ.code;break}if(e){if(o.authorityCode===e)o.isChecked||t.authList.map(s=>({...s,isChecked:!1}));else if(o.isChecked){const s=t.authList.find(r=>r.authorityCode===e);s.isChecked||(s.isChecked=!0)}}},F=async()=>{try{h.value=!0;const o=await $();o.success&&o.data.applicationAuthorityList.reduce((e,s)=>{const{groupId:r}=s;return e[r-1]?e[r-1].push(s):e[r-1]=[s],e},[]).forEach(e=>{_.value.push({name:e[0].groupName,groupId:e[0].groupId,authList:e.map(s=>({...s,isChecked:!1}))})})}catch(o){console.error("getAppAuth Error",o)}finally{h.value=!1}},M=async()=>{try{const o=await B(Number(C.id));if(o.success){f.groupName=o.data.groupName,g.value=o.data.memo;const t=[];_.value.forEach(e=>{t.push(...e.authList)}),o.data.authorities.forEach(e=>{t.forEach(s=>{e===s.authorityId&&(s.isChecked=!0)})})}}catch(o){console.error("getGroupInfo() Error",o)}},w=()=>{D.go(-1)},H=async()=>{if(!b.value){window.Notify.error({message:V.common.required});return}try{const o=[];_.value.forEach(s=>{s.authList.forEach(r=>{r.isChecked&&o.push(r.authorityId)})});const t={groupName:f.groupName,description:g.value,appAuthorityList:o};(await O(Number(C.id),t)).success&&(window.Notify.success({message:V.group.create}),w())}catch(o){console.error("onEditGroup() Error",o)}},P=(o,t)=>{q(o,t)};return Q(async()=>{await F(),await M()}),(o,t)=>{var s,r,x;const e=X("tooltip");return n(),u("div",ae,[c("div",ie,[c("div",ne,[c("span",ce,y(a(m)("UserGroupEdit.그룹_수정")),1),c("div",de,[p(L,{modelValue:f.groupName,"onUpdate:modelValue":t[0]||(t[0]=i=>f.groupName=i),name:"groupName",required:"",width:"w-80","error-msg":(r=(s=a(A))==null?void 0:s.groupName)!=null&&r.length?(x=a(A))==null?void 0:x.groupName[0].message:"",label:a(m)("UserGroupCreate.그룹명")},null,8,["modelValue","error-msg","label"]),p(L,{modelValue:g.value,"onUpdate:modelValue":t[1]||(t[1]=i=>g.value=i),name:"groupInfo",width:"w-[26rem]",label:a(m)("UserGroupCreate.그룹_설명")},null,8,["modelValue","label"])])]),c("div",ue,[E(p(I,{icon:"arrow-down-tray","button-text":"저장",disabled:!a(b),onClick:H},null,8,["disabled"]),[[e,a(m)("UserGroupCreate.저장")]]),E(p(I,{icon:"x-mark",onClick:w},null,512),[[e,a(m)("UserGroupCreate.취소")]])])]),h.value?(n(),u("div",le,[p(te)])):v("",!0),h.value?v("",!0):(n(),u("div",pe,[(n(!0),u(R,null,G(_.value,i=>(n(),u("div",{key:i.name,class:"bg-white dark:bg-dark border dark:border-dark-border rounded-lg shadow-md"},[c("div",me,y(i.name),1),(n(!0),u(R,null,G(i.authList,d=>(n(),u("div",{key:d.authorityCode,class:"flex justify-between px-3 py-1"},[c("div",fe,[c("div",null,y(d.authorityName),1),d.authorityExplain?E((n(),Z(a(ee),{key:0,class:"w-5 h-5 text-gray-400 cursor-pointer outline-none"},null,512)),[[e,d.authorityExplain]]):v("",!0)]),p(oe,{modelValue:d.isChecked,"onUpdate:modelValue":N=>d.isChecked=N,onClick:N=>P(d,i)},null,8,["modelValue","onUpdate:modelValue","onClick"])]))),128))]))),128))]))])}}});export{Ee as default};
