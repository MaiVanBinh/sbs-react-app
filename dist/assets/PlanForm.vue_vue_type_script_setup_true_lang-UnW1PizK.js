import{k as C,aq as $,ap as Y,o as X,E as Z,ae as D,f as i,d as ee,u as oe,ar as se,t as re,ai as L,aj as y,j as _,a as P,c as E,Y as r,G as t,as as R,a1 as N,ak as le,a2 as k,at as A,w as F,a0 as te,K as I,h as M}from"./index-eLyz9_Ts.js";import{a as G,u as ce}from"./journalist-QNhBHHjf.js";import"./organization-qjYuRO6g.js";import{u as ue}from"./PlanHeader.vue_vue_type_script_setup_true_lang-kVPG60_7.js";import{_ as w}from"./FormLabel.vue_vue_type_script_setup_true_lang-SB4ukE1P.js";import{_ as V}from"./FormItem.vue_vue_type_script_setup_true_lang-ZXQ_7x89.js";import{_ as ne}from"./PermissionSettingModal.vue_vue_type_script_setup_true_lang-Cz5aOmSI.js";import{_ as de}from"./UserSearchModal.vue_vue_type_script_setup_true_lang-iHw_FmsN.js";import{_ as me}from"./BasisTypeSelect.vue_vue_type_script_setup_true_lang-7Pe-eM4w.js";function Ee(){const e=C(),{movePlanList:p}=Y(),{deleteTabBy:d,getActiveTab:s}=$();return{formRef:e,closedTabAndMovePage:()=>{d(s),p()},handleFormButton:async()=>{var f;if(e.value)try{await((f=e.value)==null?void 0:f.onSubmitPlan())}catch(g){console.error("Failed onSubmitPlan",g)}}}}function pe(e){const p=G(),d=s=>{e.forEach(u=>{const v=p.currentPlatform==="mac",f=v?s.code.toLowerCase()===`key${u.key}`.toLowerCase():s.key.toLowerCase()===u.key.toLowerCase(),g=v&&u.metaKey&&s.metaKey||!v&&u.ctrlKey&&s.ctrlKey;if(f&&g)return s.preventDefault(),s.stopPropagation(),u.callback(),!1})};X(()=>{window.addEventListener("keydown",d,{capture:!0,passive:!1})}),Z(()=>{window.removeEventListener("keydown",d,{capture:!0})})}const h={DEFAULTS:{BRDC_PGM_ID:21,PLAN_USER_ID:1,PLAN_DEPT_ID:1,ARTCL_PUBLSH_YN:"N",PLAN_DT:D().format("YYYY-MM-DD"),INPUT_DEPT_NAME:"",REPORT_ID:1}},K=e=>({titl:(e==null?void 0:e.titl)??"",brdcPgmId:(e==null?void 0:e.brdcPgmId)??h.DEFAULTS.BRDC_PGM_ID,brdcPgmNm:(e==null?void 0:e.brdcPgmNm)??"",aggBasisCd:(e==null?void 0:e.aggBasisCd)??"",ctt:(e==null?void 0:e.ctt)??"",prdCmpnt:(e==null?void 0:e.prdCmpnt)??"",accessUserId:(e==null?void 0:e.accessUserId)??"",deviTyp:(e==null?void 0:e.deviTyp)??"",artclPublshYn:(e==null?void 0:e.artclPublshYn)??h.DEFAULTS.ARTCL_PUBLSH_YN,planDeptId:(e==null?void 0:e.planDeptId)??h.DEFAULTS.PLAN_DEPT_ID,planUserNm:(e==null?void 0:e.planUserNm)??"",planUserId:(e==null?void 0:e.planUserId)??h.DEFAULTS.PLAN_USER_ID,planDeptNm:(e==null?void 0:e.planDeptNm)??"",planDt:(e==null?void 0:e.planDt)??h.DEFAULTS.PLAN_DT,updateDeptId:(e==null?void 0:e.updateDeptId)??0,updateDeptNm:(e==null?void 0:e.updateDeptNm)??"",reportId:h.DEFAULTS.REPORT_ID}),ve=e=>{const d=i().getPayload,{deptId:s,deptNm:u}=d||{};return{titl:e.titl,aggBasisCd:e.aggBasisCd,ctt:e.ctt,prdCmpnt:e.prdCmpnt,accessUserDeptId:[],accessUserDeptNm:[],planDeptId:e.planDeptId,planDeptNm:e.planDeptNm,artclPublshYn:e.artclPublshYn,planUserId:e.planUserId,planDt:e.planDt,inputDeptId:s,inputDeptNm:u,reportId:e.reportId}},fe={class:"w-[75%] border p-2"},ae={class:"flex gap-2 items-start"},_e={class:"flex gap-x-2"},he={class:"mt-4"},ge={class:"mt-4 h-[calc(100vh-400px)]"},Se={class:"flex-1 border border-md ml-2 p-2"},be={class:"my-4 flex flex-col gap-y-2"},ye={class:"flex flex-col w-full"},Pe={key:0,class:"text-error text-xs mt-1"},ke={class:"flex items-center gap-x-2"},x="primary",Re=ee({__name:"PlanForm",props:{mode:{},formData:{}},emits:["on-submit-plan","show-video-coverage-modal"],setup(e,{expose:p,emit:d}){const s=e,u=d,v=oe(),{movePlanList:f}=Y(),{getActiveTab:g,deleteTab:j}=$(),O=G(),q=ce(),{setPlanId:z}=q,m=C({permission:!1,userSearch:!1}),U=C(),c=C(s.mode==="create"?K():s.formData??K()),{titl:S,titlError:H,aggBasisCd:b,aggBasisCdError:B,handleSubmit:J}=ue(),a={form:{onSubmit:J(async()=>{const l=ve({...c.value,titl:S.value,aggBasisCd:b.value});u("on-submit-plan",l)}),onBasisSelect:l=>{c.value.aggBasisCd=String(l.id)}},modal:{toggleUserSearch:()=>{m.value.userSearch=!m.value.userSearch},togglePermission:()=>{m.value.permission=!m.value.permission},userSelect:l=>{if(l.length>0){const o=l[0];c.value.planDeptId=o.deptId||0,c.value.planDeptNm=o.deptNm||"",c.value.planUserId=Number(o.id),c.value.planUserNm=o.userNm||""}}},ui:{focusSearchButton:()=>{U.value.onFocusButton()}}},Q=l=>{switch(l.srcKey){case"save":{a.form.onSubmit();break}case"close":{j(g),f();break}}};return pe([{key:"p",metaKey:!0,ctrlKey:!0,callback:()=>{console.log("print shortkey logic")}},{key:"s",metaKey:!0,ctrlKey:!0,callback:()=>{console.log("save shortkey logic")}}]),se(()=>{s.mode==="edit"&&z(Number(v.params.planId))}),re(()=>s.formData,l=>{l&&s.mode==="edit"&&(c.value=l,S.value=l.titl,b.value=String(l.aggBasisCd||""))},{immediate:!0}),p({onSubmitPlan:a.form.onSubmit}),(l,o)=>{const T=L("tooltip"),W=L("shortkey");return y((P(),E("div",{class:"flex h-[calc(100vh-160px)]",onShortkey:Q},[r("div",fe,[r("div",ae,[t(N,{modelValue:_(S),"onUpdate:modelValue":o[0]||(o[0]=n=>R(S)?S.value=n:null),class:"flex-grow",placeholder:"기획서 제목 입력","error-msg":_(H),intent:x},null,8,["modelValue","error-msg"]),r("div",_e,[y(t(le,{icon:"sparkles",class:"bg-primary text-white p-1"},null,512),[[T,"맞춤법검사"]]),t(k,{"button-text":"취재의뢰",onClick:o[1]||(o[1]=n=>u("show-video-coverage-modal"))}),t(k,{"button-text":"CG의뢰"}),t(k,{"button-text":"영상편집의뢰"})])]),r("div",he,[t(w,{icon:"chevronRight",label:"제작구성 요소"}),r("label",null,[y(r("textarea",{"onUpdate:modelValue":o[2]||(o[2]=n=>c.value.prdCmpnt=n),class:"w-full h-20 border mt-2 p-2 resize-none"},null,512),[[A,c.value.prdCmpnt]])])]),r("div",ge,[t(w,{icon:"chevronRight",label:"기사주요내용"}),r("label",null,[y(r("textarea",{"onUpdate:modelValue":o[3]||(o[3]=n=>c.value.ctt=n),class:"w-full h-full border border-gray-300 mt-2 p-2 truncate shadow-sm focus:outline-none resize-none"},null,512),[[A,c.value.ctt]])])])]),r("div",Se,[t(w,{icon:"chevronRight",label:"상세정보"}),r("div",be,[r("div",null,[t(V,{label:"발제근거"},{default:F(()=>[r("div",ye,[t(me,{modelValue:_(b),"onUpdate:modelValue":o[4]||(o[4]=n=>R(b)?b.value=n:null),required:!0,class:"w-full"},null,8,["modelValue"]),_(B)?(P(),E("span",Pe,te(_(B)),1)):I("",!0)])]),_:1})]),r("div",ke,[t(V,{label:"기획자",class:"flex-grow"},{default:F(()=>[t(N,{id:"department","model-value":c.value.planDeptNm,class:"flex-grow",readonly:"",intent:x,onClick:a.ui.focusSearchButton},null,8,["model-value","onClick"]),t(N,{id:"planner",class:"flex-grow","model-value":c.value.planUserNm,readonly:"",intent:x,onClick:a.ui.focusSearchButton},null,8,["model-value","onClick"]),y(t(k,{ref_key:"searchButtonRef",ref:U,icon:"user",class:"p-2 bg-primary text-white",onClick:a.modal.toggleUserSearch},null,8,["onClick"]),[[T,"검색"]])]),_:1})])]),r("div",null,[m.value.permission?(P(),M(ne,{key:0,onClose:o[5]||(o[5]=n=>m.value.userSearch=!1)})):I("",!0)]),r("div",null,[m.value.userSearch?(P(),M(de,{key:0,onSelectedRow:a.modal.userSelect,onClose:o[6]||(o[6]=n=>m.value.userSearch=!1)},null,8,["onSelectedRow"])):I("",!0)])])],32)),[[W,_(O).currentShortkeys]])}}});export{Re as _,Ee as u};
