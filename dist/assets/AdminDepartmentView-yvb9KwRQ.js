import{d as L,k as v,t as ue,l as M,ai as G,a as r,h as _,w as O,Q as B,ax as q,Y as p,c as C,K,F as z,i as P,a6 as pe,M as he,G as D,a0 as A,X as j,a2 as N,aj as V,C as Y,cR as Q,d8 as X,cz as H,j as $,az as ge,eE as fe,ew as ye,a5 as J,a1 as Z,L as ee,a3 as we,ad as ve,o as De,aG as Ce,ah as E}from"./index-eLyz9_Ts.js";import{u as ke}from"./department-wnuBQoCo.js";import{d as be}from"./vuedraggable.umd--AjKxttX.js";import{_ as xe}from"./GNoData.vue_vue_type_script_setup_true_lang-rWUb5JCO.js";import"./vue.runtime.esm-bundler-3P3R-Xon.js";const Ie=["onClick","onDblclick"],$e={key:0,class:"flex w-full justify-center"},_e={key:0},Se={key:0,class:"mr-1"},Ne=L({__name:"TreeTableRow",props:{rowData:{type:Array,required:!0,default:()=>[]},childrenUpdated:{type:Function,required:!0},columnDefs:{type:Array,default:()=>[]},isDraggable:{type:Boolean,default:!1},selectedIdKey:{type:String,default:"id"},childrenKey:{type:String,default:"children"},childrenOpenKey:{type:String,default:"isChildOpen"},selectedItem:{type:[String,Number],default:""}},emits:["children-Updated","children-add","selected-row","on-double-click-row"],setup(e,{emit:h}){const o=e,m=h,c=v(o.rowData);ue(()=>o.rowData,i=>{c.value=i},{deep:!0,flush:"post"});const k=M(()=>`grid-template-columns: ${o.columnDefs.reduce((a,t)=>{let n=a;return"maxWidth"in t&&t.maxWidth?n+=` minmax(60px, ${t==null?void 0:t.maxWidth}px)`:"minWidth"in t&&t.minWidth?n+=` minmax(${t==null?void 0:t.minWidth}px, 1fr)`:n+=" 1fr",n},o.isDraggable?"30px":"")}`),g=i=>{m("children-Updated",i)},b=i=>{m("children-add",i)},u=i=>{m("selected-row",i)},x=i=>{m("on-double-click-row",i)};return(i,a)=>{const t=G("tooltip");return r(),_($(be),{list:c.value,tag:"div","item-key":n=>n.departmentId,group:{name:"edit_list_draggable_nested"},disabled:!e.isDraggable,class:"layout-tr",sort:!1,handle:".drag-handle",onChange:a[0]||(a[0]=n=>g(n))},{item:O(({element:n})=>[(r(),C("div",{key:n[e.selectedIdKey]},[p("div",{class:B(["grid grid-flow-col items-center hover:bg-primary/20",e.selectedItem===n[e.selectedIdKey]?"bg-selected-row":""]),style:q(k.value),onClick:s=>u(n),onDblclick:s=>x(n)},[e.isDraggable?(r(),C("div",$e,a[1]||(a[1]=[p("div",{class:"ag-drag-handle ag-row-drag drag-handle","aria-hidden":"true"},[p("span",{class:"ag-icon ag-icon-grip",unselectable:"on",role:"presentation"})],-1)]))):K("",!0),(r(!0),C(z,null,Y(o.columnDefs,(s,f)=>(r(),C(z,{key:s.field},[s.slot?(r(),C("div",_e,[P(i.$slots,s.field,{row:n,index:f},void 0,!0)])):(r(),C("div",{key:1,class:B(["drag-table-td",{target:s.treeField}])},[s.treeField?(r(),C("span",Se,[D(pe,{size:"w-5 h-5",class:B(n[e.childrenOpenKey]?"":"text-primary"),icon:n[e.childrenOpenKey]?"minus-circle":"plus-circle",onClick:he(y=>n[e.childrenOpenKey]=!n[e.childrenOpenKey],["stop","prevent"])},null,8,["class","icon","onClick"])])):K("",!0),j(" "+A(n[s.field])+" ",1),s.addButton?V((r(),_(N,{key:1,class:"ml-1 add-button",icon:"plus",type:"secondary",onClick:y=>b(n)},null,8,["onClick"])),[[t,s.addTooltip]]):K("",!0)],2))],64))),128))],46,Ie),n[e.childrenOpenKey]?(r(),_(te,{key:0,"is-draggable":e.isDraggable,"row-data":n[e.childrenKey],"selected-item":e.selectedItem,"column-defs":e.columnDefs,class:"item-sub","children-updated":e.childrenUpdated,"selected-id-key":e.selectedIdKey,"children-key":e.childrenKey,"children-open-key":e.childrenOpenKey,onChildrenAdd:b,onSelectedRow:u,onOnDoubleClickRow:x},H({_:2},[Y(i.$slots,(s,f)=>({name:f,fn:O(y=>[P(i.$slots,f,X(Q(y||{})),void 0,!0)])}))]),1032,["is-draggable","row-data","selected-item","column-defs","children-updated","selected-id-key","children-key","children-open-key"])):K("",!0)]))]),_:3},8,["list","item-key","disabled"])}}}),te=ge(Ne,[["__scopeId","data-v-3b714999"]]),Oe={class:"w-full h-full flex flex-col space-y-2"},Ke={class:"w-full h-full bg-white rounded-md dark:text-white text-sm dark:bg-dark-grid overflow-x-auto overflow-y-auto"},Re={key:1,class:"drag-table"},Ae={key:0},Ve={class:"flex px-2 justify-end"},Me=L({__name:"GTreeTable",props:{list:{type:Array,default:()=>[]},columnDefs:{type:Array,default:()=>[]},isDraggable:{type:Boolean,default:!1},selectedIdKey:{type:String,default:"id"},childrenKey:{type:String,default:"Children"},childrenOpenKey:{type:String,default:"isChildOpen"},pageInfo:{type:Object,default:()=>({isShow:!1,page:1,totalPages:1,totalElements:0,numberOfElements:0,size:1})}},emits:["on-change-row","children-add","selected-row","on-change-page","on-double-click-row"],setup(e,{emit:h}){const o=e,m=M(()=>o.list),c=h,k=v(""),g=t=>{c("on-change-row",t)},b=M(()=>`grid-template-columns: ${o.columnDefs.reduce((n,s)=>{let f=n;return"maxWidth"in s&&s.maxWidth?f+=` minmax(50px, ${s==null?void 0:s.maxWidth}px)`:"minWidth"in s&&s.minWidth?f+=` minmax(${s==null?void 0:s.minWidth}px, 1fr)`:f+=" 1fr",f},o.isDraggable?"30px":"")}`),u=t=>{c("children-add",t)},x=t=>{k.value=t[o.selectedIdKey],c("selected-row",t)},i=t=>{c("on-change-page",t)},a=t=>{c("on-double-click-row",t)};return(t,n)=>(r(),C("div",Oe,[p("div",Ke,[e.list.length?(r(),C("div",Re,[p("div",{class:"grid drag-table-th grid-flow-col items-center",style:q(b.value)},[e.isDraggable?(r(),C("div",Ae)):K("",!0),(r(!0),C(z,null,Y(e.columnDefs,s=>(r(),C("div",{key:s.field,class:"px-4"},A(s.headerName),1))),128))],4),e.columnDefs.length>0?(r(),_(te,{key:0,"is-draggable":e.isDraggable,"row-data":m.value,"column-defs":e.columnDefs,"selected-item":k.value,"children-updated":g,"selected-id-key":e.selectedIdKey,"children-key":e.childrenKey,"children-open-key":e.childrenOpenKey,onChildrenAdd:u,onSelectedRow:x,onOnDoubleClickRow:a},H({_:2},[Y(t.$slots,(s,f)=>({name:f,fn:O(y=>[P(t.$slots,f,X(Q(y||{})))])}))]),1032,["is-draggable","row-data","column-defs","selected-item","selected-id-key","children-key","children-open-key"])):K("",!0)])):(r(),_(xe,{key:0}))]),p("div",Ve,[e.pageInfo.isShow?(r(),_(fe,{key:0,"page-info":e.pageInfo,onOnChangePage:i},null,8,["page-info"])):K("",!0)])]))}}),Ee=L({__name:"DepartmentList",props:{isLoading:{type:Boolean},rowData:{},pageInfo:{}},emits:["on-toggle-use","click-children-add","on-change-row-data","selected-row","on-change-page"],setup(e,{emit:h}){const o=e,m=h,c=[{headerName:"부서명",field:"departmentName",minWidth:260,treeField:!0,addButton:!0,addTooltip:"하위 부서 추가"},{headerName:"생성자",field:"inputerName",minWidth:160},{headerName:"수정자",field:"updaterName",minWidth:160},{headerName:"수정일시",field:"updateDateTime",minWidth:200},{headerName:"사용여부",field:"useYn",maxWidth:100,slot:!0}],k=M(()=>o.rowData),g=(a,t)=>{const n={...t,useYn:a};m("on-toggle-use",n)},b=a=>{m("on-change-row-data",a)},u=a=>{m("click-children-add",a)},x=a=>{m("on-change-page",a)},i=a=>{m("selected-row",a)};return(a,t)=>(r(),_(Me,{"is-draggable":!0,list:k.value,"column-defs":c,"children-key":"childDepartmentList","children-open-key":"isChildOpen","selected-id-key":"departmentId","page-info":a.pageInfo,onOnChangeRow:b,onChildrenAdd:u,onSelectedRow:i,onOnChangePage:x},{useYn:O(({row:n})=>[D(ye,{"model-value":n.useYn==="Y","onUpdate:modelValue":s=>g(s,n)},null,8,["model-value","onUpdate:modelValue"])]),_:1},8,["list","page-info"]))}}),Le={class:""},We={class:"px-2 py-4 space-y-6"},Ue={class:"space-y-2 text-sm"},Ye={class:"space-x-3 flex items-center justify-end"},Te=L({__name:"DepartmentInfoModal",props:{mode:{default:"create"},departmentItem:{default:""}},emits:["on-create","on-edit","close"],setup(e,{emit:h}){const o=e,m=h,{t:c}=J(),k=v(!1),g=v(o.mode==="create"?"":o.departmentItem.departmentName),b=()=>{m("close")},u=async()=>{try{k.value=!0;const a={departmentName:g.value.trim()};o.mode==="create"?m("on-create",a):m("on-edit",a)}catch(a){console.error("DepartmentInfoModal onSubmit() Error",a)}finally{k.value=!1}},x=M(()=>o.mode==="create"?c("Modal.Department.CreateModal.부서_추가"):c("Modal.Department.EditModal.부서_수정")),i=M(()=>o.mode==="create"?c("Modal.Department.CreateModal.추가"):c("Modal.Department.EditModal.수정"));return(a,t)=>(r(),_(we,{"modal-class":"sm:w-1/2 2xl:w-[25vw]",onClose:b},{title:O(()=>[p("span",Le,A(x.value),1)]),content:O(()=>[p("div",We,[p("div",Ue,[D(Z,{modelValue:g.value,"onUpdate:modelValue":t[0]||(t[0]=n=>g.value=n),required:!0,label:$(c)("Modal.Department.CreateModal.부서_명"),onKeyup:ee(u,["enter"])},null,8,["modelValue","label"])]),p("div",Ye,[D(N,{type:"secondary",onClick:t[1]||(t[1]=n=>a.$emit("close"))},{default:O(()=>[j(A($(c)("Modal.User.CreateModal.취소")),1)]),_:1}),D(N,{loading:k.value,disabled:!g.value.trim(),onClick:u},{default:O(()=>[j(A(i.value),1)]),_:1},8,["loading","disabled"])])])]),_:1}))}}),Be={class:"h-full"},ze={class:"flex justify-between"},Pe={class:"flex items-center space-x-2"},je={class:"space-x-2 w-[210px]"},Fe={class:"text-xl dark:text-dark-gray-200"},Ge={class:"text-xl text-gray-500"},qe={class:"space-x-1.5"},Qe={class:"flex flex-col h-[95%]"},tt=L({__name:"AdminDepartmentView",setup(e){const{t:h}=J(),o=v(!1),m=ke(),{fetchDepartments:c,createDepartment:k,updateDepartment:g}=m,b=v(""),u=v([]),x=v(!1),i=v("create"),a=v(),t=v(ve.sm),n=v({isShow:!1,page:1,totalElements:1,totalPages:1,numberOfElements:1,size:t.value}),s=v(),f=l=>l.map(d=>({...d,isChildOpen:!0,childDepartmentList:d.childDepartmentList?f(d.childDepartmentList):[]})),y=async()=>{try{o.value=!0;const l={departmentName:b.value},d=await c(l);d.success&&(u.value=f(d.data.departmentList))}catch(l){console.error("AdminCategoryView: getDepartments Error",l)}finally{o.value=!1}},W=l=>{i.value=l,x.value=!0},T=()=>{x.value=!1},ae=async l=>{try{const d={...l};s.value&&(d.parentDepartmentId=s.value.departmentId),(await k(d)).success&&(window.Notify.success({message:E.department.create}),await y(),T())}catch(d){console.error("AdminCategoryView: onCreateCategory() Error",d)}},ne=()=>{s.value=null,W("create")},se=l=>{a.value=l,W("edit")},le=l=>{u.value=l},de=l=>{s.value=l,W("create")},oe=l=>{a.value=l},ie=async()=>{let l=0;const d=(R,S)=>R.map(w=>{l+=1;let F=w.parentDepartmentId;return S&&S!==w.parentDepartmentId&&(F=S),{...w,orderNo:l,parentDepartmentId:F,childDepartmentList:w.childDepartmentList?d(w.childDepartmentList,w.departmentId):null}});(await g(d(u.value))).success&&(window.Notify.success({message:E.department.edit}),await y())},U=({list:l,filed:d,selectKey:I,changeValue:R}={})=>l.map(S=>{const w={...S};return w.departmentId===I&&(w[d]=R),w.childDepartmentList&&(w.childDepartmentList=U({list:w.childDepartmentList,filed:d,selectKey:I,changeValue:R})),w}),re=async l=>{try{const d=U({list:u.value,filed:"useYn",selectKey:l.departmentId,changeValue:l.useYn?"Y":"N"});(await g(d)).success&&(window.Notify.success({message:E.department.edit}),await y())}catch(d){console.error("AdminUserView: onChangeUseYn() Error ",d)}},ce=async l=>{try{const d=U({list:u.value,filed:"departmentName",selectKey:a.value.departmentId,changeValue:l.departmentName});(await g(d)).success&&(window.Notify.success({message:E.department.edit}),await y(),T())}catch(d){console.error("AdminCategoryView: onEditCategory() Error",d)}},me=async()=>{try{const l=U({list:u.value,filed:"delYn",selectKey:a.value.departmentId,changeValue:"Y"});(await g(l)).success&&(window.Notify.success({message:E.department.delete}),await y())}catch(l){console.error("AdminCategoryView: onDelete() Error",l)}};return De(()=>{y()}),(l,d)=>{var R;const I=G("tooltip");return r(),C("div",Be,[p("div",ze,[p("div",Pe,[p("div",je,[p("span",Fe,A($(h)("Department.부서")),1),p("span",Ge,A($(h)("Department.부서수",{department:u.value.length})),1)]),D(Z,{modelValue:b.value,"onUpdate:modelValue":d[0]||(d[0]=S=>b.value=S),width:"w-96",placeholder:$(h)("Department.부서명으로_검색하세요"),onKeyup:ee(y,["enter"])},null,8,["modelValue","placeholder"]),D(N,{icon:"magnifying-glass",onClick:y})]),p("div",qe,[V(D(N,{icon:"arrow-path",onClick:y},null,512),[[I,$(h)("Department.새로고침")]]),V(D(N,{icon:"arrows-up-down",disabled:o.value,onClick:ie},null,8,["disabled"]),[[I,$(h)("Department.순서_변경")]]),V(D(N,{icon:"plus",disabled:o.value,onClick:ne},null,8,["disabled"]),[[I,$(h)("Department.추가")]]),V(D(N,{icon:"pencil",disabled:o.value||!a.value,onClick:d[1]||(d[1]=S=>W("edit"))},null,8,["disabled"]),[[I,$(h)("Department.수정")]]),V(D(Ce,{disabled:o.value||!a.value,title:(R=a.value)==null?void 0:R.deptNm,onOnConfirm:me},null,8,["disabled","title"]),[[I,$(h)("Department.삭제")]])])]),p("div",Qe,[D(Ee,{"is-loading":o.value,"row-data":u.value,"page-info":n.value,onOnToggleUse:re,onClickChildrenAdd:de,onOnChangeRowData:le,onSelectedRow:oe,onOnDoubleClickRow:se},null,8,["is-loading","row-data","page-info"])]),x.value?(r(),_(Te,{key:0,mode:i.value,"department-item":a.value,onOnCreate:ae,onOnEdit:ce,onClose:T},null,8,["mode","department-item"])):K("",!0)])}}});export{tt as default};
