import{d as O,a5 as V,a as m,c as w,Y as l,G as r,a6 as tt,a0 as L,j as c,a1 as M,k as b,t as et,w as _,aa as ot,aD as st,u as nt,V as at,l as S,o as it,an as F,h as N,K as v,ao as lt,ap as rt}from"./index-eLyz9_Ts.js";import{_ as ct}from"./VDCEditor.vue_vue_type_script_setup_true_lang-IhnNo6sk.js";import{_ as ut}from"./ConfirmModal.vue_vue_type_script_setup_true_lang-k_ZxaDhN.js";import{_ as D}from"./ModalButton.vue_vue_type_script_setup_true_lang-WIw8hxFk.js";import{_ as dt}from"./FileDropzone.vue_vue_type_script_setup_true_lang-SVeHifZw.js";import{u as E}from"./file-Gx0JxWZZ.js";import{_ as mt,a as pt}from"./BulletinBoardHeader.vue_vue_type_script_setup_true_lang-tOD6ZD7P.js";import{F as ft}from"./file-division-code-x51qUgaH.js";const yt={class:"text-primary-gray-40 dark:text-white"},vt={class:"flex items-center justify-start mb-4"},bt={class:"font-bold"},_t={class:"grid grid-cols-12 gap-2 mb-2.5 items-center"},ht={class:"col-span-2 text-right"},xt=O({__name:"BulletinBoardInformation",props:{dataInfo:{}},setup(B){const{t}=V();return(a,h)=>(m(),w("div",yt,[l("div",vt,[r(tt,{icon:"custom-chevron",size:"w-5 h-5",class:"mr-2"}),l("p",bt,L(c(t)("Community.상세정보")),1)]),l("div",_t,[l("p",ht,L(c(t)("Community.작성자")),1),r(M,{"model-value":a.dataInfo.inputrNm,intent:"primary",class:"col-span-5",readonly:"",placeholder:c(t)("Community.텍스트를 입력하세요")},null,8,["model-value","placeholder"]),r(M,{"model-value":a.dataInfo.inputrDeptNm,intent:"primary",class:"col-span-5",readonly:"",placeholder:c(t)("Community.텍스트를 입력하세요")},null,8,["model-value","placeholder"])])]))}}),wt={class:"text-primary-purple-500 dark:text-white"},Bt=O({__name:"BulletinBoardAttachFile",props:{fileList:{}},emits:["update:fileList"],setup(B,{emit:t}){const a=B,h=t,{fileDownload:g}=E(),p=b(a.fileList||[]),P=d=>{g(d.file)},f=(d,u)=>{u.stopPropagation(),u.preventDefault(),p.value.splice(d,1)};return et(()=>p.value,d=>{h("update:fileList",d)}),(d,u)=>(m(),w("div",wt,[l("div",null,[r(dt,{"file-data":p.value,"onUpdate:fileData":u[0]||(u[0]=C=>p.value=C),mode:"create","is-tripped":!0,"is-center":!0,icon:"plus-circle",message:"드래그앤 드랍 또는 클릭으로 파일을 추가하세요","custom-class-icon":"mb-2 text-primary-gray-surface-500","file-list-custom-class":"text-black dark:text-white px-0","is-show-file-list-bottom":"",onOnDownloadFile:P,onOnDeleteFile:f},{description:_(()=>u[1]||(u[1]=[l("div",{class:"mb-8 mt-2 mx-2"},[l("p",null,"* 파일 하나당 최대 200MB까지 업로드할 수 있습니다."),l("p",null,"* 등록 개수는 최대 5개 입니다.")],-1)])),_:1},8,["file-data"])])]))}}),gt={class:"dark:text-white text-xs"},Ct={class:"flex justify-between flex-grow h-full overflow-y-hidden flex-wrap pt-2"},kt={class:"flex flex-col w-[70%] p-2.5 border border-primary-gray-999 rounded-md h-[85vh]"},It={class:"flex items-center gap-2 mb-3"},Nt={class:"w-[40px] text-right mr-2 font-bold text-primary-gray-40 dark:text-white"},Dt={class:"flex-grow overflow-y-auto"},Pt={class:"flex flex-col w-[29.5%] py-2 px-1 border border-primary-gray-999 rounded-md h-[85vh]"},$t={class:"px-11 h-[50px] border-t border-primary-gray-surface flex items-center justify-center"},Ft={key:0,class:"flex items-center justify-center gap-x-2 p-2 w-full"},Lt={key:1,class:"flex items-center justify-center gap-x-2 w-full"},Et=O({__name:"BulletinBoardCreateAndEdit",props:{id:{},bulletinBoardId:{}},setup(B){const t=B,{t:a}=V(),h={id:3,name:a("Community.코맨트")},g=[{id:1,name:a("Community.상세정보")},{id:2,name:a("Community.첨부파일")},h],{fileUpload:p}=E(),{getUserInfo:P}=ot(),f=st(),{moveListCommunityBulletinBoard:d}=rt(),u=nt(),C=b([]),y=b([]),i=b({bulletinBbId:0,bulletinBbPostTitl:"",bulletinBbPostCtt:"",inputrNm:"",inputrDeptId:0,inputDtm:"",delYn:"N"}),T=b(null),$=b(!1),o=at({isOpen:!1,title:"",content:"",type:"confirm",case:"confirm",icon:"exclamationCircle"}),x=S(()=>!!t.id),U=S(()=>P),A=n=>n.map(s=>({...s,name:s.fileNm,fileId:s.id})),Y=async(n,s)=>{try{const e=await f.community.bulletinBoard.getDetailPost(n,s);e.success&&(i.value=e.data,y.value=A(e.data.attcFiles))}catch(e){console.log("Fail to get bulletin board",e)}},G=async()=>{var e;if(!y.value)return[];const n=(e=y==null?void 0:y.value)==null?void 0:e.map(async I=>{if(I.type){const Z={fileName:I.name,fileDivisionCode:ft.Board.id,publicYn:"Y",file:I},R=await p(Z);if(R.success)return R.data.id}else return I.id});return await Promise.all(n)},K=()=>{o.title="Information",o.isOpen=!0,o.content=a("Community.제목을 입력하여 주세요"),o.type="basic",o.case="check-title",o.icon="customInfo"},q=()=>{o.title="확인",o.isOpen=!0,o.content=x.value?`${a("Community.내용이 변경되었습니다")}.
${a("Community.저장하시겠습니까?")}`:a("Community.저장하시겠습니까?"),o.type="confirm",o.case=x.value?"edit":"create",o.icon="customQuestionMark"},z=()=>{T.value.onClose()},k=()=>{o.isOpen=!1},Q=async(n,s)=>{if(!t.bulletinBoardId)return;const e=await f.community.bulletinBoard.updatePost(t.bulletinBoardId,n,s);e!=null&&e.success?(window.Notify.success({message:"success"}),d(u,"Edit",{bulletinBoardId:t.bulletinBoardId})):window.Notify.error({message:e.msg})},H=async n=>{if(!t.bulletinBoardId)return;const s=await f.community.bulletinBoard.createPost(t.bulletinBoardId,n);s!=null&&s.success?(window.Notify.success({message:"success"}),d(u,"Create",{bulletinBoardId:t.bulletinBoardId})):window.Notify.error({message:s.msg})},J=()=>{if(!i.value.bulletinBbPostTitl){K();return}q()},W=async()=>{k();const n=await G(),s={bulletinBbPostTitl:i.value.bulletinBbPostTitl||"",bulletinBbPostCtt:i.value.bulletinBbPostCtt||"",inputUserNm:i.value.inputrNm||"",inputDeptNm:i.value.inputrDeptNm||"",attcFileIds:n.length?n:[]};x.value&&t.id?Q(t.id,s):H(s)},X=n=>{i.value={...i.value,...n}},j=async()=>{if(!(!t.bulletinBoardId||!t.id)){$.value=!0;try{const n=await f.community.bulletinBoard.getComments(t.bulletinBoardId,t.id);n.success&&(C.value=n.data)}catch(n){console.log("Fail to get comment",n)}finally{$.value=!1}}};return it(async()=>{if(t.id&&t.bulletinBoardId){await Y(t.bulletinBoardId,t.id),await j();return}i.value.inputrNm=U.value.userNm,i.value.inputrDeptNm=U.value.deptNm}),(n,s)=>(m(),w("div",gt,[r(mt,{ref_key:"headerRef",ref:T,"is-edit-and-create":!0,onOnSave:J},null,512),l("div",Ct,[l("div",kt,[l("div",It,[l("p",Nt,L(c(a)("Community.제목")),1),r(M,{modelValue:i.value.bulletinBbPostTitl,"onUpdate:modelValue":s[0]||(s[0]=e=>i.value.bulletinBbPostTitl=e),name:"title",class:"w-3/5",intent:"primary","custom-input-class":"rounded-none"},null,8,["modelValue"])]),l("div",Dt,[r(ct,{content:i.value.bulletinBbPostCtt,"editor-class":"h-full","onUpdate:content":s[1]||(s[1]=e=>i.value.bulletinBbPostCtt=e)},null,8,["content"])])]),l("div",Pt,[l("div",null,[r(lt,{"is-plain-text-mode":!0,"overflow-class":!0,tabs:x.value?g:g.filter(e=>e.id!==h.id),"is-compact-mode":!0,class:"justify-center space-y-3 rounded-xl"},{default:_(()=>[r(c(F),null,{default:_(()=>[r(xt,{"data-info":i.value,"onUpdate:dataInfo":X},null,8,["data-info"])]),_:1}),r(c(F),null,{default:_(()=>[r(Bt,{"file-list":y.value},null,8,["file-list"])]),_:1}),x.value?(m(),N(c(F),{key:0},{default:_(()=>{var e;return[t.id&&t.bulletinBoardId?(m(),N(pt,{key:0,class:"overflow-auto dark:!bg-dark-secondary h-[calc(100vh-260px)]","comment-list":C.value,"comment-count":(e=i.value)==null?void 0:e.commentCount,"current-board-id":t.bulletinBoardId,"current-post-id":t.id,"is-loading-comments":$.value,onOnRefresh:j},null,8,["comment-list","comment-count","current-board-id","current-post-id","is-loading-comments"])):v("",!0)]}),_:1})):v("",!0)]),_:1},8,["tabs"])])])]),o.isOpen?(m(),N(ut,{key:0,"use-slot":"",intent:"secondary",text:o.content,type:o.type,title:o.title,icon:o.icon,onClose:k},{bottom:_(()=>[l("div",$t,[o.type==="basic"?(m(),w("div",Ft,[r(D,{text:"OK",icon:"check",onClick:k})])):v("",!0),o.type==="confirm"?(m(),w("div",Lt,[r(D,{text:c(a)("Community.예"),icon:"check",onClick:W},null,8,["text"]),r(D,{type:"warning",text:c(a)("Community.아니요"),icon:"xMark",onClick:z},null,8,["text"]),o.case==="edit"?(m(),N(D,{key:0,type:"warning",text:c(a)("Community.취소"),icon:"xMark",onClick:k},null,8,["text"])):v("",!0)])):v("",!0)])]),_:1},8,["text","type","title","icon"])):v("",!0)]))}});export{Et as _};
