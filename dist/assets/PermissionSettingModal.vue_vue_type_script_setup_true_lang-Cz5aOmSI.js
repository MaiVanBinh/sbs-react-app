import{d as I,a as n,h as x,Q as V,a2 as S,k as f,l as D,al as H,c as _,K as $,Y as i,a0 as T,a7 as P,F as B,C as O,aP as Y,w as z,G as b,a1 as L,j,a3 as K}from"./index-eLyz9_Ts.js";import{u as Q}from"./organization-qjYuRO6g.js";import{_ as q}from"./FormLabel.vue_vue_type_script_setup_true_lang-SB4ukE1P.js";import{_ as W}from"./FormItem.vue_vue_type_script_setup_true_lang-ZXQ_7x89.js";import{_ as J}from"./OrganizationSelect.vue_vue_type_script_setup_true_lang-BNuugYEX.js";const M=I({__name:"TabButton",props:{buttonText:{},isActive:{type:Boolean}},emits:["tab-selected"],setup(C,{emit:h}){const o=C,a=h,p=()=>{a("tab-selected",o.buttonText)};return(c,g)=>(n(),x(S,{"button-text":c.buttonText,"button-color":"bg-white",type:"tab",class:V(["space-x-0 hover:text-primary hover:font-bold",[c.isActive?"bg-white text-primary font-bold":"bg-gray-200 text-black"]]),onClick:p},null,8,["button-text","class"]))}}),A=I({__name:"UserList",props:{users:{},selectedUserIds:{default:void 0},isSelectedList:{type:Boolean,default:!1}},emits:["selection-change"],setup(C,{emit:h}){const o=C,a=h,p=f(null),c=[{headerName:"선택",headerClass:"text-xs",checkboxSelection:!0,maxWidth:60},{headerName:"부서명",headerClass:"text-xs",field:"deptNm",filter:!1,sortable:!1,minWidth:90,flex:1},{headerName:"사용자ID",headerClass:"text-xs",field:"userId",filter:!1,sortable:!1,maxWidth:120,cellClass:"text-center"},{headerName:"사용자명",headerClass:"text-xs",field:"userNm",filter:!1,sortable:!1,maxWidth:100,cellClass:"text-center"}],g=[{headerName:"선택",checkboxSelection:!0,maxWidth:60},{headerName:"사용자(부서)명",field:"userNm",minWidth:100,flex:1,cellClass:"text-center"}],k=D(()=>o.isSelectedList?g:c),t=D(()=>o.users.filter(e=>{var r;return!((r=o.selectedUserIds)!=null&&r.includes(e.userId))})),u=e=>{p.value=e.api},w=()=>{const e=p.value.getSelectedRows();a("selection-change",e)},l={suppressRowClickSelection:!0};return(e,r)=>(n(),x(H,{"row-data":t.value,"column-defs":k.value,"grid-options":l,"row-selection":"multiple",onOnGridReady:u,onSelectedRows:w},null,8,["row-data","column-defs"]))}}),X={class:"text-gray-700 text-xs"},Z={key:1,class:"ml-2 text-xs text-gray-500"},ee=I({__name:"TeamItem",props:{dept:{},selectable:{type:Boolean},isSelected:{type:Boolean}},emits:["select"],setup(C,{emit:h}){const o=h;return(a,p)=>(n(),_("div",{class:V(["flex items-center py-2 px-3 hover:bg-gray-50 cursor-pointer group",{"bg-blue-50":a.selectable&&a.isSelected,"hover:bg-blue-100":a.selectable}]),onClick:p[0]||(p[0]=c=>o("select",a.dept))},[a.selectable?(n(),_("span",{key:0,class:V(["mr-2 w-4 h-4 flex items-center justify-center text-blue-500 opacity-0 group-hover:opacity-100",{"opacity-100":a.isSelected}])}," ✓ ",2)):$("",!0),i("span",X,T(a.dept.deptNm),1),a.dept.teamNm?(n(),_("span",Z,T(a.dept.teamNm),1)):$("",!0)],2))}}),te={key:0,class:"mr-2 w-4 h-4 inline-flex items-center justify-center"},se={key:1,class:"mr-2 w-4 h-4"},le={class:"text-xs font-medium"},ne={key:0,class:"ml-6"},ae=I({__name:"DepartmentNode",props:{node:{},selectable:{type:Boolean},selectedDepts:{},isExpanded:{type:Function}},emits:["toggle-node","select-dept"],setup(C,{emit:h}){const o=C,a=h,p=D(()=>o.isExpanded(o.node.orgId)),c=D(()=>o.node.children.length>0||o.node.departments.length>0),g=()=>{c.value&&a("toggle-node",o.node.orgId)},k=t=>{o.selectable&&a("select-dept",t)};return(t,u)=>{const w=P("department-node",!0);return n(),_("div",null,[i("div",{class:"flex items-center py-2 px-3 hover:bg-gray-50 cursor-pointer",onClick:g},[c.value?(n(),_("span",te,T(t.isExpanded(t.node.orgId)?"−":"+"),1)):(n(),_("span",se)),i("span",le,T(t.node.orgNm),1)]),p.value?(n(),_("div",ne,[(n(!0),_(B,null,O(t.node.children,l=>(n(),x(w,{key:l.orgId,node:l,selectable:t.selectable,"selected-depts":t.selectedDepts,"is-expanded":t.isExpanded,onToggleNode:u[0]||(u[0]=e=>t.$emit("toggle-node",e)),onSelectDept:u[1]||(u[1]=e=>t.$emit("select-dept",e))},null,8,["node","selectable","selected-depts","is-expanded"]))),128)),(n(!0),_(B,null,O(t.node.departments,l=>(n(),x(ee,{key:l.deptId,dept:l,selectable:t.selectable,"is-selected":t.selectedDepts.has(l.teamNm?`${l.deptId}_${l.teamNm}`:`${l.deptId}`),onSelect:k},null,8,["dept","selectable","is-selected"]))),128))])):$("",!0)])}}}),oe={class:"bg-white rounded-lg shadow h-full overflow-auto"},re={class:"p-1"},de={class:"space-y-1"},ce=I({__name:"DepartmentHierarchy",props:{organizationData:{},selectable:{type:Boolean}},emits:["selection-change"],setup(C,{expose:h,emit:o}){const a=C,p=o,c=f(new Set),g=f(new Set),k=()=>{const e=Array.from(c.value).map(r=>{if(r.includes("_")){const[y,N]=r.split("_");return{type:"department",userId:y,userNm:N,deptNm:N,userMngId:y}}return{type:"department",userId:r,userNm:"",deptNm:"",userMngId:r}});p("selection-change",e)},t=e=>{const r=e.teamNm?`${e.deptId}_${e.teamNm}`:`${e.deptId}`;c.value.has(r)?c.value.delete(r):c.value.add(r),k()},u=e=>{g.value.has(e)?g.value.delete(e):g.value.add(e)},w=e=>g.value.has(e);return h({clearSelection:()=>{c.value.clear(),k()}}),(e,r)=>(n(),_("div",oe,[i("div",re,[i("div",de,[(n(!0),_(B,null,O(e.organizationData,y=>(n(),x(ae,{key:y.orgId,node:y,selectable:a.selectable,"selected-depts":c.value,"is-expanded":w,onToggleNode:u,onSelectDept:t},null,8,["node","selectable","selected-depts"]))),128))])])]))}}),ie={class:"flex flex-col flex-1 overflow-hidden"},ue={class:"flex items-center justify-between border rounded-md p-3 bg-gray-50"},me={class:"flex gap-2"},pe={class:"flex flex-1 mt-4 overflow-hidden"},ve={class:"flex-1 border rounded-md bg-white shadow-sm flex flex-col"},fe={class:"flex border-b bg-gray-100"},he={class:"flex-1 p-2 overflow-hidden"},ge={class:"flex-none w-1/6 flex flex-col justify-center items-center space-y-3"},be={class:"flex-1 border rounded-md bg-white shadow-sm p-3 flex flex-col overflow-hidden"},xe={class:"flex-1 overflow-hidden"},_e={class:"flex justify-center gap-x-2 mb-2"},Se=I({__name:"PermissionSettingModal",emits:["close","on-submit"],setup(C,{emit:h}){const o=h,a=Q(),{fetchUsers:p,fetchOrganizations:c}=a,{users:g,organizations:k}=Y(a),t=f("personal"),u=f(""),w=f(null),l=f([]),e=f([]),r=f([]),y=f([]),N=f([]),E=f(),G=D(()=>l.value.length===0),F=D(()=>l.value.filter(s=>s.type==="user").map(s=>s.userId)),v={tab:{select:s=>{t.value=s}},organization:{select:s=>{const d=s.useDeptCd?{useDeptCd:s.useDeptCd}:{orgDivCd:s.orgDivCd,orgCd:s.orgCd};w.value=d,p({...d,searchValue:u.value})}},selections:{users:s=>{e.value=s},departments:s=>{r.value=s||[]},removeUsers:s=>{y.value=s},RemoveDepartments:s=>{N.value=s}},actions:{add:()=>{var s;if(t.value==="personal"&&e.value.length){const d=e.value.map(m=>({type:"user",userId:m.userId,userNm:m.userNm,deptNm:m.deptNm,userMngId:m.userMngId}));l.value=[...l.value,...d],e.value=[]}else if(t.value==="department"&&r.value.length){r.value.filter(U=>l.value.some(R=>R.type==="department"&&R.userId===U.userId)).length>0&&window.Notify.warning({message:"이미 추가된 부서입니다"});const m=r.value.filter(U=>!l.value.some(R=>R.type==="department"&&R.userId===U.userId));l.value=[...l.value,...m],r.value=[],(s=E.value)==null||s.clearSelection()}},remove:()=>{if(y.value.length||N.value.length){const s=[...y.value,...N.value];l.value=l.value.filter(d=>!s.some(m=>m.userId===d.userId&&m.type===d.type)),y.value=[],N.value=[]}},search:()=>{if(t.value==="personal"){const s=w.value?{...w.value,searchValue:u.value}:{searchValue:u.value};p(s)}else c({delYn:"",newsOrgYn:""})},submit:()=>{o("on-submit",l.value),o("close")},close:()=>{o("close")}}};return(s,d)=>(n(),x(K,{"modal-class":"w-[60%] max-w-4xl","content-class":"flex flex-col h-[70vh]",onClose:v.actions.close},{title:z(()=>d[4]||(d[4]=[i("span",{class:"text-lg font-semibold"},"권한 설정",-1)])),content:z(()=>[i("div",ie,[i("div",ue,[t.value==="personal"?(n(),x(W,{key:0,label:"사용자"},{default:z(()=>[b(J,{onOnSelected:v.organization.select},null,8,["onOnSelected"])]),_:1})):$("",!0),t.value==="department"?(n(),x(W,{key:1,label:"부서명"},{default:z(()=>[b(L,{modelValue:u.value,"onUpdate:modelValue":d[0]||(d[0]=m=>u.value=m),placeholder:"검색어를 입력하세요."},null,8,["modelValue"])]),_:1})):$("",!0),i("div",me,[t.value==="personal"?(n(),x(L,{key:0,modelValue:u.value,"onUpdate:modelValue":d[1]||(d[1]=m=>u.value=m),placeholder:"검색어를 입력하세요.",class:"max-w-xs"},null,8,["modelValue"])):$("",!0),b(S,{"button-text":"조회",class:"ml-2",onClick:v.actions.search},null,8,["onClick"])])]),i("div",pe,[i("div",ve,[i("div",fe,[b(M,{"button-text":"개인","is-active":t.value==="personal",class:"flex-1 py-2",onTabSelected:d[2]||(d[2]=m=>v.tab.select("personal"))},null,8,["is-active"]),b(M,{"button-text":"부서","is-active":t.value==="department",class:"flex-1 py-2",onTabSelected:d[3]||(d[3]=m=>v.tab.select("department"))},null,8,["is-active"])]),i("div",he,[t.value==="personal"?(n(),x(A,{key:0,users:j(g),"selected-user-ids":F.value,class:"h-full",onSelectionChange:v.selections.users},null,8,["users","selected-user-ids","onSelectionChange"])):(n(),x(ce,{key:1,ref_key:"departmentHierarchyRef",ref:E,"organization-data":j(k),selectable:!0,class:"h-full",onSelectionChange:v.selections.departments},null,8,["organization-data","onSelectionChange"]))])]),i("div",ge,[b(S,{"button-text":"추가",icon:"chevronDoubleRight",size:"sm",onClick:v.actions.add},null,8,["onClick"]),b(S,{"button-text":"삭제",icon:"chevronDoubleLeft",size:"sm",onClick:v.actions.remove},null,8,["onClick"])]),i("div",be,[b(q,{icon:"chevronRight",label:"사용자 & 부서 설정된 목록",class:"mb-2"}),i("div",xe,[b(A,{users:l.value,"is-selected-list":!0,onSelectionChange:v.selections.removeUsers},null,8,["users","onSelectionChange"])])])])])]),bottom:z(()=>[i("div",_e,[b(S,{"button-text":"확인",type:"primary",disabled:G.value,onClick:v.actions.submit},null,8,["disabled","onClick"]),b(S,{"button-text":"취소",type:"warning",onClick:v.actions.close},null,8,["onClick"])])]),_:1},8,["onClose"]))}});export{Se as _};
