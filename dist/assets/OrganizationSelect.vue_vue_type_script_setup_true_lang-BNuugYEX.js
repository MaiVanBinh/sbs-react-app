import{d as P,aP as Q,k as c,l as v,o as j,a as D,c as A,Y as H,h as k,Q as h,K as U,G as z}from"./index-eLyz9_Ts.js";import{u as W}from"./organization-qjYuRO6g.js";import{G as y}from"./GSingleSelect-7u8H0FdH.js";const X={class:"flex items-center gap-x-1"},_=P({__name:"OrganizationSelect",props:{modelValue:{default:""},placeholder:{default:"조직 선택"},disabled:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1},required:{type:Boolean,default:!1},width:{default:"w-28"},customClass:{default:""},isNewsRoom:{type:Boolean,default:!1},hideFirstDepth:{type:Boolean,default:!1},hideSecondDepth:{type:Boolean,default:!1},fixedCompanyId:{default:1},fixedBusinessUnit:{default:2}},emits:["update:modelValue","on-selected"],setup(R,{emit:F}){const d=R,N=F,S=W(),{fetchOrganizations:Y}=S,{organizations:i}=Q(S),w=c(!1),u=c(null),g=e=>{u.value=e},C=()=>{u.value=null},n=c(),s=c(),a=c(),r=c(),I=()=>{var p,m,f,B;const e="",o="",l="",t={companyId:((p=n.value)==null?void 0:p.orgId)||void 0,businessUnitId:((m=s.value)==null?void 0:m.orgId)||void 0,departmentId:((f=a.value)==null?void 0:f.orgId)||void 0,teamId:((B=r.value)==null?void 0:B.deptId)||void 0,orgDivCd:e,orgCd:o,useDeptCd:l};a.value&&!r.value?(t.orgDivCd="D",t.orgCd=a.value.orgCd,t.teamId=void 0):r.value?t.useDeptCd=r.value.useDeptCd:s.value?(t.orgDivCd="S",t.orgCd=s.value.orgCd):n.value&&(t.orgDivCd="C",t.orgCd=n.value.orgCd),N("update:modelValue",JSON.stringify(t)),N("on-selected",t)},T=v(()=>i.value?i.value.filter(e=>e.hrnkOrgId===null):[]),O=v(()=>{if(!n.value||!i.value)return[];const e=i.value.find(o=>{var l;return o.orgId===((l=n.value)==null?void 0:l.orgId)});return(e==null?void 0:e.children)||[]}),b=v(()=>{var e,o,l;if(d.isNewsRoom)return i.value||[];if((e=s.value)!=null&&e.orgId){const t=(o=i.value)==null?void 0:o.find(m=>m.orgId===d.fixedCompanyId),p=(l=t==null?void 0:t.children)==null?void 0:l.find(m=>{var f;return m.orgId===((f=s.value)==null?void 0:f.orgId)});return(p==null?void 0:p.children)||[]}return[]}),V=v(()=>{if(!a.value)return[];if(d.isNewsRoom)return a.value.departments||[];const e=b.value.find(o=>{var l;return o.orgId===((l=a.value)==null?void 0:l.orgId)});return(e==null?void 0:e.departments)||[]}),G=v(()=>d.isNewsRoom?!1:d.hideFirstDepth&&!d.hideSecondDepth?!s.value:b.value.length===0),E=v(()=>!a.value||V.value.length===0),q=e=>{var o;(e==null?void 0:e.orgId)!==((o=n.value)==null?void 0:o.orgId)&&(n.value=e,s.value=void 0,a.value=void 0,r.value=void 0,I())},J=e=>{var o;(e==null?void 0:e.orgId)!==((o=s.value)==null?void 0:o.orgId)&&(s.value=e,a.value=void 0,r.value=void 0,I())},K=e=>{var o;(e==null?void 0:e.orgId)!==((o=a.value)==null?void 0:o.orgId)&&(a.value=e,r.value=void 0,I())},L=e=>{var o;(e==null?void 0:e.deptId)!==((o=r.value)==null?void 0:o.deptId)&&(r.value=e,I())},M=async()=>{var e;try{w.value=!0;const o={delYn:"N",newsOrgYn:"Y",...d.isNewsRoom&&{orgDivCd:"D",localYn:"N"}};await Y(o),!d.isNewsRoom&&d.hideFirstDepth&&(n.value=(e=i.value)==null?void 0:e.find(l=>l.orgId===d.fixedCompanyId))}catch(o){console.error("OrganizationSelect loadOrganizations Error",o)}finally{w.value=!1}};return j(()=>{M()}),(e,o)=>(D(),A("div",null,[H("div",X,[e.hideFirstDepth?U("",!0):(D(),k(y,{key:0,modelValue:n.value,"onUpdate:modelValue":[o[0]||(o[0]=l=>n.value=l),q],class:h(e.customClass),options:T.value,intent:"primary","track-by":"orgId","item-label":"orgNm",placeholder:e.placeholder,disabled:e.disabled||e.readonly,"close-on-select":!0,open:u.value==="company",onOpen:o[1]||(o[1]=()=>g("company")),onClose:C},null,8,["modelValue","class","options","placeholder","disabled","open"])),!e.hideSecondDepth&&!e.isNewsRoom?(D(),k(y,{key:1,modelValue:s.value,"onUpdate:modelValue":[o[2]||(o[2]=l=>s.value=l),J],class:h([e.customClass,e.width]),options:O.value,intent:"primary","track-by":"orgId","item-label":"orgNm",placeholder:"본부 선택",disabled:e.hideFirstDepth?!1:!n.value||O.value.length===0,"close-on-select":!0,open:u.value==="businessUnit",onOpen:o[3]||(o[3]=()=>g("businessUnit")),onClose:C},null,8,["modelValue","class","options","disabled","open"])):U("",!0),z(y,{"model-value":a.value,class:h([e.customClass,e.width]),options:b.value,intent:"primary","track-by":"orgId","item-label":"orgNm",placeholder:"부서 선택",disabled:G.value,"close-on-select":!0,open:u.value==="department","onUpdate:modelValue":K,onOpen:o[4]||(o[4]=()=>g("department")),onClose:C},null,8,["model-value","class","options","disabled","open"]),z(y,{"model-value":r.value,class:h([e.customClass,e.width]),options:V.value,intent:"primary","track-by":"deptId","item-label":"deptNm",placeholder:"팀 선택",disabled:E.value,"close-on-select":!0,open:u.value==="team","onUpdate:modelValue":L,onOpen:o[5]||(o[5]=()=>g("team")),onClose:C},null,8,["model-value","class","options","disabled","open"])])]))}});export{_};
