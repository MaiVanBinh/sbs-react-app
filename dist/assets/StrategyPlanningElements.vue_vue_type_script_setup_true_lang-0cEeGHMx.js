import{B as q}from"./buttons-3hbXC8Cn.js";import{l as N,d as j,a as i,c as v,G as b,w as W,a1 as B,av as Ce,k as R,o as J,E as ke,j as re,aj as le,au as Se,Y as $,X as Ne,ak as z,t as Ie,h as I,Q as ne,aw as de,F as oe,C as ae,a2 as H,K as A,ax as se,ay as ie,az as Te,aA as Ee,u as Ve,ac as Pe,ai as $e,al as je,aB as Oe,aC as Fe}from"./index-eLyz9_Ts.js";import{c as G,a as De}from"./journalist-QNhBHHjf.js";import"./organization-qjYuRO6g.js";import{_ as L}from"./FormItem.vue_vue_type_script_setup_true_lang-ZXQ_7x89.js";import{a as g}from"./make-grid-column-aeLSdEws.js";function it(m,o){const n=N(()=>[{id:1,label:"기사보기",action:()=>{var t;return(t=o==null?void 0:o.openModal)==null?void 0:t.call(o,"articleView")}},{id:2,label:"목록"},{id:3,label:"닫기",action:o==null?void 0:o.closedTabAndMovePage}]),l=N(()=>[{id:1,label:"삽입",action:o==null?void 0:o.insertRow},{id:2,label:"추가",action:o==null?void 0:o.addRow},{id:3,label:"삭제",action:()=>{var t;return(t=o==null?void 0:o.openModal)==null?void 0:t.call(o,"elementDelete")},disabled:m==null?void 0:m(q.DELETE)},{id:4,label:"기사보기",action:()=>{var t;return(t=o==null?void 0:o.openModal)==null?void 0:t.call(o,"articleView")},disabled:m==null?void 0:m(q.VIEW_ARTICLE)},{id:5,label:"기사",action:()=>{var t;return(t=o==null?void 0:o.openModal)==null?void 0:t.call(o,"cuesheetArticleSearch")},disabled:m==null?void 0:m(q.SEARCH_ARTICLE)},{id:6,label:"저장"},{id:6,label:"새로저장"},{id:7,label:"정보",action:()=>{var t;return(t=o==null?void 0:o.openModal)==null?void 0:t.call(o,"strategyPlanningInfo")}},{id:8,label:"목록"},{id:9,label:"닫기",action:o==null?void 0:o.closedTabAndMovePage}]);return{detailMenuItems:n,editMenuItems:l}}const Me={class:"flex gap-x-2 p-2 bg-gray-200"},ct=j({__name:"StrategyPlanningInfo",emits:["open-edit-modal"],setup(m,{emit:o}){const n=o,l=G(),t=N(()=>l.infoData),c=N(()=>Ce(t.value.mtDtm)),r=N(()=>l.mode==="edit"),u=()=>{r.value&&n("open-edit-modal")};return(x,f)=>(i(),v("div",Me,[b(L,{label:"제목"},{default:W(()=>[b(B,{id:"titl",modelValue:t.value.titl,"onUpdate:modelValue":f[0]||(f[0]=_=>t.value.titl=_),readonly:"",onOnFocus:u},null,8,["modelValue"])]),_:1}),b(L,{label:"차수"},{default:W(()=>[b(B,{id:"ord",modelValue:t.value.ord,"onUpdate:modelValue":f[1]||(f[1]=_=>t.value.ord=_),readonly:"",onOnFocus:u},null,8,["modelValue"])]),_:1}),b(L,{label:"아이템개수"},{default:W(()=>[b(B,{id:"elementCount",modelValue:t.value.elementCount,"onUpdate:modelValue":f[2]||(f[2]=_=>t.value.elementCount=_),readonly:"",onOnFocus:u},null,8,["modelValue"])]),_:1}),b(L,{label:"회의일자"},{default:W(()=>[b(B,{id:"mtDtm",modelValue:c.value,"onUpdate:modelValue":f[3]||(f[3]=_=>c.value=_),readonly:"",onOnFocus:u},null,8,["modelValue"])]),_:1})]))}}),We={class:"flex justify-center items-center h-screen"},Be={key:0,class:"relative"},Le={class:"absolute -top-14 left-1/2 transform -translate-x-1/2 bg-primary text-white text-sm px-4 py-2 rounded shadow-lg min-w-[150px] max-w-[150px] text-center"},ze={key:1},Ge=j({__name:"CustomNoRow",props:{params:{type:Object,required:!0}},setup(m){const o=m,{mode:n}=G(),l=R(!1),t=()=>{o.params.context.onAddRow()};return J(()=>{l.value=!0}),ke(()=>{l.value=!1}),(c,r)=>(i(),v("div",We,[re(n)==="edit"?(i(),v("div",Be,[le($("div",Le,r[0]||(r[0]=[Ne(" 새로운 행 추가 "),$("div",{class:"absolute left-1/2 transform -translate-x-1/2 bottom-[-8px] w-0 h-0 border-l-[8px] border-r-[8px] border-t-[8px] border-t-primary border-b-0 border-l-transparent border-r-transparent"},null,-1)]),512),[[Se,l.value]]),b(z,{icon:"plusCircle","icon-size":"h-10 w-10",class:"text-primary",onClick:t})])):(i(),v("div",ze,"no elements"))]))}}),Q=j({__name:"CustomPlatformButton",props:{params:{type:Object,required:!0}},setup(m){const o=m,n=o.params.platform,l=R(!1),t=N(()=>!o.params.isCategory&&o.params.mode==="edit"),c=()=>{l.value=!l.value;const r=o.params.data,u=r.plat?r.plat.split(","):[];if(l.value)u.push(n);else{const x=u.indexOf(n);x>-1&&u.splice(x,1)}r.plat=u.join(","),o.params.api.applyTransaction({update:[r]}),o.params.selectPlatform(o.params.data)};return Ie(()=>o.params.data.plat,r=>{if(r){const u=r.split(",");l.value=u.includes(n)}},{immediate:!0}),(r,u)=>(i(),I(z,{class:ne(["absolute inset-0 m-auto text-black opacity-100 transition-opacity duration-100 ease-in-out"]),icon:l.value?"check":"",cursor:t.value?"cursor-pointer":"cursor-default",onClick:u[0]||(u[0]=x=>t.value?c():null)},null,8,["icon","cursor"]))}}),Ue=["onClick"],Ke={key:0,class:"flex justify-center items-center h-full"},Xe={key:0,class:"w-8 h-8 border-2 border-gray-400 rounded-md flex items-center justify-center"},Ye={key:1,class:"w-8 h-8 border-2 border-gray-400 rounded-md flex items-center justify-center"},qe={class:"grid grid-cols-2 gap-2 p-2"},He={key:0,class:"border-2 text-center hover:bg-gray-200 hover:cursor-pointer"},Qe={key:1,class:"border-2 text-center hover:bg-gray-200"},Ae=j({__name:"CustomFrameButton",props:{params:{type:Object,required:!0}},setup(m,{expose:o}){const n=m,l=R(["","",""]),t=R(null),c=R({top:0,left:0}),r=R(null),u=N(()=>!n.params.isCategory&&!n.params.isCategory&&n.params.mode==="edit"),x=[{id:"00",name:"",icon:""},{id:"01",name:"첨부파일",icon:"PaperClip"},{id:"02",name:"중계",icon:""},{id:"03",name:"출연",icon:""},{id:"04",name:"회상",icon:""},{id:"05",name:"L.S",icon:""},{id:"06",name:"C.S",icon:""},{id:"07",name:"TEXT",icon:""}],f=()=>{t.value=null},_=(y,h)=>{t.value===y?f():(t.value=y,c.value={top:h.clientY+10,left:h.clientX+10})},O=(y,h)=>{l.value[h]=y;const d=n.params.data,C=d.frm?d.frm.split(","):[];C.includes(y)||C.push(y),d.frm=C.join(","),n.params.api.applyTransaction({update:[d]}),n.params.selectFrame(n.params.data),f()},U=y=>{const h=n.params.data,d=h.frm?h.frm.split(","):[];delete d[y],delete l.value[y],h.frm=d.join(",").replace(/,$/,""),n.params.api.applyTransaction({update:[h]}),n.params.selectFrame(n.params.data),f()};return de(r,()=>{f()}),J(()=>{const h=n.params.data.frm.split(",");l.value=h}),o({closeFrameIconList:f}),(y,h)=>(i(),v("div",{ref_key:"refElement",ref:r,class:"flex justify-between items-center space-x-2"},[(i(),v(oe,null,ae([0,1,2],d=>{var C,P,F;return $("div",{key:d,class:ne(["w-1/3 h-5 relative",u.value?"cursor-pointer":"cursor-default"]),onClick:p=>u.value&&_(d,p)},[n.params.isCategory?A("",!0):(i(),v("div",Ke,[l.value[d]?(i(),v("div",Ye,[(C=x.find(p=>p.id===l.value[d]))!=null&&C.icon?(i(),I(z,{key:0,icon:(P=x.find(p=>p.id===l.value[d]))==null?void 0:P.icon},null,8,["icon"])):(i(),I(H,{key:1,"button-text":(F=x.find(p=>p.id===l.value[d]))==null?void 0:F.name,type:"text"},null,8,["button-text"]))])):(i(),v("div",Xe))])),(i(),I(ie,{to:"body"},[t.value===d?(i(),v("div",{key:0,ref_for:!0,ref_key:"refElement",ref:r,class:"absolute bg-white shadow-lg border rounded z-55",style:se({top:c.value.top+"px",left:c.value.left+"px",width:"auto",height:"auto"})},[$("div",qe,[(i(),v(oe,null,ae(x,(p,T)=>$("div",{key:T,class:"rounded-md"},[p.icon.length>0?(i(),v("div",He,[b(z,{icon:p.icon,class:"py-[6px]",onClick:D=>u.value&&O(p.id,d)},null,8,["icon","onClick"])])):(i(),v("div",Qe,[p.name?(i(),I(H,{key:1,"button-text":p.name,type:"text",onClick:D=>u.value&&O(p.id,d)},null,8,["button-text","onClick"])):(i(),I(H,{key:0,"button-text":"선택해제",class:"text-red-400",type:"text",onClick:D=>u.value&&U(d)},null,8,["onClick"]))]))])),64))])],4)):A("",!0)]))],10,Ue)}),64))],512))}}),Je={},Ze={class:"p-2 w-40 text-sm"};function et(m,o){return i(),v("div",Ze,o[0]||(o[0]=[Ee('<div class="flex justify-between"><div>라인삽입</div><div>Alt+i</div></div><div class="flex justify-between"><div>라인추가</div><div>Alt+a</div></div><div class="mb-1 flex justify-between"><div>라인삭제</div><div>Alt+d</div></div><hr><div class="mt-1 flex justify-between"><div>기사내용보기</div><div>Alt+c</div></div><div class="flex justify-between"><div>붙여넣기</div><div>Ctrl+v</div></div><div class="flex justify-between"><div>복사</div><div>Ctrl+c</div></div>',7)]))}const tt=Te(Je,[["render",et]]),ot=m=>{const o=m.trim();if(/^\d{4}$/.test(o)){const t=parseInt(o.slice(0,2),10),c=parseInt(o.slice(2,4),10);return t>24||t===24&&c>0?"24:00":`${t<10?`0${t}`:t}:${c<10?`0${c}`:c}`}const n=/^(\d{2}):(\d{2})$/,l=o.match(n);if(l){const t=parseInt(l[1],10),c=parseInt(l[2],10);return t>24||t===24&&c>0?"24:00":o}return""},ut=j({__name:"StrategyPlanningElements",emits:["update:selectedItems"],setup(m,{expose:o,emit:n}){const l=n;let t=null;const c=Ve(),r=G(),{setInfoElements:u,createRow:x,updateRow:f,moveRow:_,removeRow:O}=r,U=Pe(),y=De(),h=R(!1),d=R(!1),C=R({top:0,left:0}),P=R(null),F=N(()=>r.rowData),p=R({typ:"",ord:1,no:"",titl:"",inputr:"",plat:"",frm:"",releaseTime:"",rmk:""}),T=(e="below")=>{var X;if(!t)return;const a=t.getSelectedRows(),s={...r.newRow};let w=0,k=1;if(a.length>0){const Re=(X=a[0])==null?void 0:X.id,Y=t.getRowNode(Re),M=Number(Y==null?void 0:Y.rowIndex);if(M!=null){w=e==="below"?M+1:M;const te=a[0];k=e==="below"?te.ord+1||1:te.ord}}s.ord=k,t.applyTransaction({add:[s],addIndex:w});const V=t.getRowNode(s.id);V&&t.refreshCells({rowNodes:[V],force:!0});const S=t.getRowNode(s.id);S&&S.setSelected(!0)},D=e=>{const a=e.data.typ,s=e.data.titl;return!a&&!s?(window.Notify.error({message:"유형 또는 제목 중 하나는 반드시 입력해야 합니다."}),!1):!0},ce=()=>{T("above")},Z=()=>{T("below")},K=async()=>{const e=Number(c.params.id);e&&await u(e)},ue=()=>{if(t)return t.getSelectedRows()},E=async e=>{if(t)try{const a=t.getSelectedRows();if(a.length===0)return;const s=a[0],w=s==null?void 0:s.id,k=t.getRowNode(w);if(!k)return;if(D(k))if(w){const V=Number(c.params.id),S=e===void 0?s:e;await f(V,S.id,S),await K(),t.refreshCells({force:!0})}else{const V=Number(c.params.id),S={...s};(await x(V,S)).success&&(t.applyTransaction({add:[S]}),await K(),t.refreshCells({force:!0}))}}catch(a){console.error("Error handleSubmitRow",a)}},me=async e=>{if(r.mode==="edit")try{const a=Number(c.params.id),s=e.node,w=Number(s.rowIndex)+1||1,k=s.data;if(await _(a,k.id,w),!t)return;t.refreshCells({force:!0})}catch(a){console.log("Error handleRowDragEnd",a)}},ee=async()=>{if(t)try{const e=t.getSelectedRows();if(e.length===0)return;const a=Number(c.params.id);if((await O(a,e.map(w=>w.id))).success){t.applyTransaction({remove:e}),t.refreshCells({force:!0});const w=e[0].rowIndex>0?e[0].rowIndex-1:0,k=t.getDisplayedRowAtIndex(w);k&&k.setSelected(!0)}else window.Notify.error({message:"요소 삭제 실패"})}catch(e){console.log("Error handleDeleteRow",e)}},pe=e=>{console.log("debug select row::::",e),U.selectArticleId=46,l("update:selectedItems",e.length>0)},fe=async e=>{if(t)try{if(e){const a=t==null?void 0:t.getSelectedNodes()[0].data;e.typ?a.typ=e.typ:(a.titl=e.titl,a.inputR=e.inputR,a.plat=e.plat,a.frm=e.frm,a.releaseTime=e.releaseTime,a.rmk=e.rmk),t==null||t.refreshCells({force:!0}),await E()}}catch(a){console.log("Error handlePasteRow",a)}},ve=e=>{const{colDef:a,newValue:s}=e;a.field==="ord"&&r.updateInput("ord",s)},we=()=>{console.log("debug onStopEditing..."),E()},ye=e=>{C.value={top:e.clientY+10,left:e.clientX+10},d.value=!d.value},he=[g({headerName:"",rowDrag:!0,maxWidth:40}),g({headerName:"row",field:"ord",maxWidth:60,hide:!0,valueGetter:e=>{var w;const a=Number((w=e.node)==null?void 0:w.rowIndex)+1;G().updateInput("ord",a)}}),g({headerName:"유형",field:"typ",maxWidth:100}),g({headerName:"NO",maxWidth:60,valueGetter:e=>Oe(e)}),g({headerName:"제목",field:"titl",minWidth:200,flex:1,cellRendererParams:e=>({isCategory:!!e.data.typ,mode:r.mode,field:"titl",updateInput:r.updateInput})}),g({headerName:"작성자",field:"inputr",maxWidth:100,cellRendererParams:e=>({isCategory:!!e.data.typ,mode:r.mode,field:"inputr",updateInput:r.updateInput})}),g({headerName:"플랫폼",headerClass:"justify-center border-b-2",maxWidth:150,children:[g({headerName:"0",cellRenderer:Q,cellRendererParams:e=>({isCategory:!!e.data.typ,mode:r.mode,platform:"0",selectPlatform:E})}),g({headerName:"8",cellRenderer:Q,cellRendererParams:e=>({isCategory:!!e.data.typ,mode:r.mode,platform:"8",selectPlatform:E})}),g({headerName:"일반",cellRenderer:Q,cellRendererParams:e=>({isCategory:!!e.data.typ,mode:r.mode,platform:"normal",selectPlatform:E})})]}),g({headerName:"형태",cellRenderer:Ae,cellRendererParams:e=>({isCategory:!!e.data.typ,mode:r.mode,selectFrame:E})}),g({headerName:"출고시간",field:"releaseTime",onCellValueChanged:e=>{const a=Fe(e),s=ot(a);e.node&&e.node.setDataValue(e.column,s)}}),g({headerName:"비고",field:"rmk",maxWidth:100,editable:e=>!e.data.typ&&r.mode==="edit",cellRendererParams:e=>({isCategory:!!e.data.typ,mode:r.mode,field:"rmk"})})],ge={getRowId:e=>e.data.id,noRowsOverlayComponent:Ge,context:{onAddRow:Z},overlayLoadingTemplate:'<div class="text-center">no items</div>',defaultColDef:{editable:!0,cellEditor:"agTextCellEditor"},onCellValueChanged:e=>{if(!h.value){const a=Number(e.rowIndex)+1;r.updateInput("ord",a)}},rowDragManaged:r.mode==="edit",rowDragEntireRow:r.mode==="edit",rowDragText:e=>{var a;return`${(a=e.rowNode)==null?void 0:a.data.titl}`}},be=e=>e.node.data.typ?{"background-color":`hsl(${Math.random()*360}, 70%, 80%)`}:e.node.data.selected?{fontWeight:"bold"}:null,xe=e=>{t=e.api},_e=e=>{switch(e.srcKey){case"lineInsert":{T("above");break}case"lineAdd":{T("below");break}case"lineRemove":{ee();break}case"copy":{const a=ue();p.value=a;break}case"paste":{fe(p.value[0]);break}}};return de(P,()=>{d.value=!1}),J(()=>{t==null||t.refreshCells({force:!0}),y.setShortKey(),K()}),o({insertRow:ce,addRow:Z,handleDeleteRow:ee,gridApi:t}),(e,a)=>{const s=$e("shortkey");return le((i(),v("div",{class:"w-full h-full",onShortkey:_e},[b(je,{class:"w-full h-full","column-defs":he,"row-data":F.value,"grid-options":ge,"get-row-style":be,"row-drag-managed":!0,onSelectedRows:pe,onOnRowDragEnd:me,onOnGridReady:xe,onCellValueChange:ve,onOnStopEditing:we,onOnRightClick:ye},null,8,["row-data"]),(i(),I(ie,{to:"body"},[d.value?(i(),v("div",{key:0,ref_key:"contextRef",ref:P,class:"absolute bg-white shadow-lg border rounded z-55",style:se({top:C.value.top+"px",left:C.value.left+"px",width:"auto",height:"auto"})},[b(tt)],4)):A("",!0)]))],32)),[[s,re(y).currentShortkeys]])}}});export{ct as _,ut as a,it as u};
