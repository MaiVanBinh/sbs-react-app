import{g as P,M as oe}from"./splitpanes.es-dEoJOrhT.js";import{d as le,ac as se,aP as ce,k as l,aU as ne,b2 as de,V as O,ae as me,aT as pe,W as ue,b5 as ve,o as fe,a as ge,c as Te,G as g,w as C,j as u,Y as ye,ag as Ae,b4 as Se,ah as T,b6 as we,a$ as L,a_ as R}from"./index-eLyz9_Ts.js";import{_ as xe,a as De}from"./ArticleTabPanel.vue_vue_type_script_setup_true_lang-vwb57C9h.js";import{F as Ce}from"./file-division-code-x51qUgaH.js";import{u as Ee}from"./tag-Q73uuSte.js";import{u as Fe}from"./file-Gx0JxWZZ.js";import{b as be}from"./async-validator.util-IJrtpoc1.js";import"./use-model-wrapper-XtiLc3Xd.js";import"./GEditor.vue_vue_type_style_index_0_lang-FifEywK1.js";import"./GEditor.vue_vue_type_script_setup_true_lang-a2qGOvtc.js";import"./ArticleTypeSelect.vue_vue_type_script_setup_true_lang-Kp5wzGNr.js";import"./article-type.code-5cb8riL1.js";import"./GSingleSelect-7u8H0FdH.js";import"./vue-multiselect-Yz8FsF-E.js";import"./SpellCheckerModal.vue_vue_type_script_setup_true_lang-Vt6XDlm8.js";import"./GMovableModal.vue_vue_type_script_setup_true_lang-elQvXjL0.js";import"./spell-check-OnBbfX8h.js";import"./PageLoader.vue_vue_type_script_setup_true_lang-ZvbvX14z.js";import"./GNoData.vue_vue_type_script_setup_true_lang-rWUb5JCO.js";import"./CuesheetPrompter-o2cqkH-a.js";import"./cuesheet-item-code-_LsFMWbX.js";import"./ArticleFileTabPanel.vue_vue_type_script_setup_true_lang-Yk1q8ET1.js";import"./GTextarea-5GIFD2Mo.js";/* empty css                                                                  */import"./FileDropzone.vue_vue_type_script_setup_true_lang-SVeHifZw.js";import"./FileListView.vue_vue_type_script_setup_true_lang-A40KFqZZ.js";import"./GVideoPlayer-1SUF8s3O.js";import"./main-sHItgwS4.js";import"./vue.runtime.esm-bundler-3P3R-Xon.js";import"./ArticleFormatSelect.vue_vue_type_script_setup_true_lang-0vSziBpo.js";import"./journalist-QNhBHHjf.js";import"./organization-qjYuRO6g.js";import"./ProgramSelect.vue_vue_type_script_setup_true_lang-UHoCrnxw.js";import"./program-omP_c4K3.js";import"./UserSelect.vue_vue_type_script_setup_true_lang-Hk5THi0e.js";import"./ArticleDivisionSelect.vue_vue_type_script_setup_true_lang-Ln9_DwnO.js";import"./category-zIRntbmZ.js";import"./GTagSelect.vue_vue_type_script_setup_true_lang-WNNVbcKh.js";import"./department-wnuBQoCo.js";import"./GDatePicker.vue_vue_type_style_index_0_lang-aP5TJiAZ.js";import"./use-date-GeeGTbYh.js";import"./GDateTimePicker-bSYwb_xW.js";/* empty css                                                                        */import"./CoveragePlanSearch.vue_vue_type_script_setup_true_lang-kZic9Ocd.js";import"./CoveragePlanList.vue_vue_type_script_setup_true_lang-vJ0F3lvx.js";import"./use-render-component-K20sHqiA.js";import"./DepartmentMultiSelect.vue_vue_type_script_setup_true_lang-OqmQVQH2.js";import"./coverage-plan-nI7mLZOB.js";import"./ConfirmButton.vue_vue_type_script_setup_true_lang-onM9evN8.js";import"./app-authority-code-Q9MU7mjP.js";import"./vue-resizable.umd.min-blE9hPz6.js";const Ne={sec:2e3},B=Ne,Ie={class:"!pt-0 h-full"},Me={class:"h-full flex flex-col p-1"},y="edit-article",It=le({__name:"ArticleDetailEditView",props:{id:{}},setup(V){const n=V,{fileUpload:$,fileDownload:k}=Fe(),E=se(),{editArticle:J,speed:F,fetchArticle:W,onImportTempArtilce:j,uploadArticleFile:G,fetchArticleFile:H,deleteArticleFile:_,onLocalStorageSaveConfirm:q}=E,{getArticleEditorState:z}=ce(E),{addTags:K}=Ee(),d=l(""),A=l("00:00"),S=l("00:00"),w=l("00:00"),m=l(ne.Straight),b=l(de.Broadcasting),o=l({anchorTextArray:[""],reporterTextArray:[""],captionArray:[]}),N=l(),t=O({reporter:"",program:void 0,anchorTime:S,reportTime:w,articleTime:A,extraTime:{isPositive:!0,time:"00:00",sec:0},division:void 0,embargo:me().format("YYYY-MM-DD HH:mm:ss"),category:void 0,importance:void 0,tag:[],coveragePlanId:void 0,urgency:!1,disaster:!1,priority:void 0}),v=l([]),x=l(!1),f=l(0),D=l({articleId:n.id,articleTitle:d.value,articleType:m.value,articleEditorState:o.value,articleMetaDataCondition:t.value}),Q=O({title:d,reporter:pe(t,"reporter")}),{pass:I,errorFields:M}=ue(Q,be.rules),X=async()=>{var a;const e=await W(Number(n.id));e.success&&(d.value=e.data.artclTitl,m.value=e.data.artclTypCd,o.value=z.value,N.value=Ae.cloneDeep(o.value),t.reporter=e.data.rptrId,t.program=e.data.brdcPgmId,t.extraTime={isPositive:e.data.artclExtTime>=0,time:Se(e.data.artclExtTime),sec:e.data.artclExtTime},t.division=e.data.artclDivCd,t.embargo=e.data.artclDivDtm,t.category=e.data.artclCateId,t.tag=e.data.articleTags.map(i=>({...i.tag,tagName:i.tag.tagNm})),t.coveragePlanId=(a=e.data.coveragePlan)==null?void 0:a.id,t.urgency=e.data.urgYn==="Y",t.disaster=e.data.disYn==="Y",t.priority=e.data.priority,v.value=e.data.articleAttachmentFileList.map(i=>({...i,name:i.fileName})))},h=async()=>{const e=await H(n.id);e.success&&(v.value=e.data.map(a=>({...a,name:a.fileName})))},Z=async e=>{if(!e)return[];const a=[];for await(const s of e){const c={fileName:s.name,fileDivisionCode:Ce.Article.id,publicYn:"Y",file:s},r=await $(c);r.success&&a.push(r.data.id)}const i={fileIdList:a};await G(n.id,i),window.Notify.success({message:T.file.create}),await h()},ee=e=>{k(e.file)},te=async e=>{try{(await _(n.id,e.id)).success&&(window.Notify.success({message:T.file.delete}),await h())}catch{console.error("ArticleEditModal: onDeleteFile() Error")}},U=()=>{D.value={articleId:n.id,articleTitle:d.value,articleType:m.value,articleEditorState:o.value,articleMetaDataCondition:t},console.log("tempArticleStorage:: ",D.value),window.localStorage.setItem(y,JSON.stringify(D.value))},ae=async()=>{var e,a,i,s,c,r,Y;try{if(!I.value){window.Notify.error({message:T.common.required});return}x.value=!0;const{articleCaps:p}=we(o.value),ie={artclTitl:d.value,artclCtt:`${JSON.stringify(o.value.reporterTextArray)}`,artclCttTime:R(F,L(o.value.reporterTextArray)),ancMentCtt:`${JSON.stringify(o.value.anchorTextArray)}`,ancMentCttTime:R(F,L(o.value.anchorTextArray)),artclTypCd:(e=m.value)==null?void 0:e.id,artclExtTime:(a=t.extraTime)==null?void 0:a.sec,attcFileYn:"N",capFnshYn:"N",articleCaps:p,tagIdList:await K(t.tag),artclDivCd:(i=t.division)==null?void 0:i.id,articleDivisionDateTime:t.embargo,artclCateId:(s=t.category)==null?void 0:s.cateId,brdcPgmId:(c=t.program)==null?void 0:c.id,rptrId:(r=t.reporter)==null?void 0:r.id,articleLinkCreateDtoList:[],coveragePlanId:t==null?void 0:t.coveragePlanId,urgYn:t.urgency?"Y":"N",disYn:t.disaster?"Y":"N",priority:(Y=t.priority)==null?void 0:Y.id};(await J(n.id,ie)).success&&(f.value=0,window.localStorage.removeItem(y),window.Notify.success({message:T.article.success.edit}))}catch(p){console.log("ArticleDetailEditView: onSaveArticle() ",p),(p.code==="ERR_NETWORK"||(p==null?void 0:p.response.data.errorCode)!==1e4)&&(q()?U():(f.value=0,window.localStorage.removeItem(y)))}finally{x.value=!1}},re=e=>{v.value.push(e)};return ve([o,m.value],()=>{f.value>0&&U(),f.value+=1},{debounce:B.sec,maxWait:B.sec,deep:!0}),fe(async()=>{var a,i,s,c,r;await X();const e=await j(y,n.id);e&&(m.value=(a=e.articleType)==null?void 0:a.id,d.value=e.articleTitle,o.value.anchorTextArray=e.articleEditorState.anchorTextArray,o.value.reporterTextArray=e.articleEditorState.reporterTextArray,t.reporter=(i=e.articleMetaDataCondition.reporter)==null?void 0:i.id,t.extraTime=e.articleMetaDataCondition.extraTime,t.division=(s=e.articleMetaDataCondition.division)==null?void 0:s.id,t.embargo=e.articleMetaDataCondition.embargo,t.category=(r=(c=e.articleMetaDataCondition)==null?void 0:c.category)==null?void 0:r.cateId,t.tag=e.articleMetaDataCondition.tag,o.value.anchorTextArray=e.articleEditorState.anchorTextArray,o.value.reporterTextArray=e.articleEditorState.reporterTextArray,o.value.captionArray=e.articleEditorState.captionArray,f.value=0)}),(e,a)=>(ge(),Te("div",Ie,[g(u(oe),{class:"default-theme"},{default:C(()=>[g(u(P),{size:"70"},{default:C(()=>{var i,s,c;return[ye("div",Me,[g(xe,{"article-title":d.value,"onUpdate:articleTitle":a[0]||(a[0]=r=>d.value=r),"article-type":m.value,"onUpdate:articleType":a[1]||(a[1]=r=>m.value=r),"article-format":b.value,"onUpdate:articleFormat":a[2]||(a[2]=r=>b.value=r),"article-time":A.value,"onUpdate:articleTime":a[3]||(a[3]=r=>A.value=r),"anchor-time":S.value,"onUpdate:anchorTime":a[4]||(a[4]=r=>S.value=r),"report-time":w.value,"onUpdate:reportTime":a[5]||(a[5]=r=>w.value=r),"article-editor-state":o.value,"onUpdate:articleEditorState":a[6]||(a[6]=r=>o.value=r),"is-loading":x.value,"origin-article-editor-state":N.value,validation:u(I),"error-msg":(s=(i=u(M))==null?void 0:i.title)!=null&&s.length?(c=u(M))==null?void 0:c.title[0].message:"",onOnSave:ae,onOnAddFile:re},null,8,["article-title","article-type","article-format","article-time","anchor-time","report-time","article-editor-state","is-loading","origin-article-editor-state","validation","error-msg"])])]}),_:1}),g(u(P),{class:"30"},{default:C(()=>[g(De,{"article-meta-data-tab":t,"onUpdate:articleMetaDataTab":a[7]||(a[7]=i=>t=i),"article-file-tab":v.value,"onUpdate:articleFileTab":a[8]||(a[8]=i=>v.value=i),"article-id":e.id,mode:"edit",class:"h-full px-1",onOnUploadFile:Z,onOnDownloadFile:ee,onOnDeleteFile:te},null,8,["article-meta-data-tab","article-file-tab","article-id"])]),_:1})]),_:1})]))}});export{It as default};
