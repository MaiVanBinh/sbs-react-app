import{d as ne,aD as pe,k as f,t as Te,o as fe,a as u,c as T,F as de,C as Ue,Q as Fe,M as we,j as r,Y as e,a0 as h,K as W,ae as Ae,az as De,a5 as ve,c6 as Ye,h as ae,w as L,X as Y,G as s,a1 as R,L as be,a2 as G,a3 as _e,V as ke,aT as me,W as Ie,l as $e,x as Ve,a6 as N,ag as te,al as je,am as qe,ew as Ge,ai as Re,aj as re,aG as Oe,ad as We}from"./index-eLyz9_Ts.js";import{d as se}from"./vuedraggable.umd--AjKxttX.js";import{G as ze}from"./GTextarea-5GIFD2Mo.js";import{G as Ne}from"./GRadioGroup-cHw1G1ew.js";import{G as ue}from"./GSingleSelect-7u8H0FdH.js";import{N as Le}from"./NoDataIcon-o0HaqPy2.js";import{g as Se}from"./async-validator.util-IJrtpoc1.js";import{N as Ce}from"./no-image-ERwb0SRC.js";import{F as Me}from"./file-division-code-x51qUgaH.js";import{r as Be}from"./use-render-component-K20sHqiA.js";import"./vue.runtime.esm-bundler-3P3R-Xon.js";/* empty css                                                                  *//* empty css                                                                    */import"./vue-multiselect-Yz8FsF-E.js";import"./use-model-wrapper-XtiLc3Xd.js";const Pe={class:"flex flex-col h-full"},Ke={key:0,class:"overflow-y-auto grid grid-cols-2 md:grid-cols-3 xl:grid-cols-5 gap-2"},Xe=["onClick","onDblclick"],He=["src"],Qe=["src"],Je={class:"space-y-1 text-sm"},Ze={class:"dark:text-dark-gray-200 text-gray-800 font-bold"},Ee={class:"eclipseExplain dark:text-dark-gray-200 text-gray-500"},et=ne({__name:"CaptionTemplateItemList",props:{searchValue:{default:""},selectedConcept:{default:""},selectedTag:{default:""}},emits:["on-select","on-double-click"],setup(E,{expose:j,emit:I}){const c=E,M=I,A=pe(),d=f(!1),w=f(),o=f(),C=async()=>{var q,y;const V={searchValue:c.searchValue,conceptId:(q=c.selectedConcept)==null?void 0:q.conceptId,tagId:(y=c.selectedTag)==null?void 0:y.tagId};console.log(V);try{d.value=!0;const O=await A.vizrt.basic.findTemplateAll(V);if(O.success){const X=O.data,Q=new DOMParser().parseFromString(X,"text/xml");w.value=Array.from(Q.querySelectorAll("entry")).map(m=>{var x;const z=(x=Array.from(m.getElementsByTagName("link")).find(D=>D.getAttribute("rel")==="suggested-thumbnail"))==null?void 0:x.getAttribute("href"),v=m.querySelector("id").textContent;let g="";return v!==null&&(g=v.match(/dbid:(\d+)/)),{thumbnail:z,title:m.querySelector("title").textContent,id:g[1],updated:Ae(m.querySelector("updated").textContent).format("YYYY-MM-DD A hh:ss")}})}}catch(O){console.log("Fail to get caption template list",O)}finally{d.value=!1}},$=V=>{var q;return((q=o.value)==null?void 0:q.id)===V},b=V=>{$(V.id)?o.value={}:o.value=V},U=V=>{o.value=V,M("on-double-click",o.value)},K=V=>{const q=V.target;q.src=Ce};return Te(()=>[c.selectedConcept,c.selectedTag,c.searchValue],async()=>{console.log(c.selectedConcept),c.selectedConcept!==""&&c.selectedTag!==""&&await C()},{deep:!0}),Te(()=>o.value,()=>{M("on-select",o.value)},{deep:!0}),fe(()=>{}),j({getCaptionTemplateItemList:C}),(V,q)=>(u(),T("div",Pe,[d.value?W("",!0):(u(),T("div",Ke,[(u(!0),T(de,null,Ue(w.value,y=>(u(),T("div",{key:y.id,class:Fe(["h-auto max-w-full rounded-lg cursor-pointer",{"border-2 p-1 border-primary":$(y.id)}]),onClick:we(O=>b(y),["stop","prevent"]),onDblclick:we(O=>U(y),["stop","prevent"])},[y!=null&&y.thumbnail?(u(),T("img",{key:0,src:`${y==null?void 0:y.thumbnail}`,alt:"image",class:"w-full aspect-video rounded-md",onError:K},null,40,He)):(u(),T("img",{key:1,src:r(Ce),alt:"no-image",class:"w-full aspect-video rounded-md"},null,8,Qe)),e("div",Je,[e("p",Ze,h(y==null?void 0:y.title),1),e("div",Ee,h(y==null?void 0:y.updated),1)])],42,Xe))),128))]))]))}}),tt=De(et,[["__scopeId","data-v-5d82b74b"]]),at={class:"flex flex-col h-full space-y-2"},lt={class:"flex items-center space-x-2"},ot={class:"flex sm:text-xs text-gray-700 dark:text-white"},st={class:"flex items-center space-x-2"},nt={class:"flex-1 overflow-y-hidden"},it={class:"flex space-x-2 justify-end"},ct=ne({__name:"CaptionTemplateItemModal",emits:["close","on-select-template-item"],setup(E,{emit:j}){const I=j,{t:c}=ve(),M=f(),A=pe(),d=f(),w=f([]),o=f(null),C=f([]),$=f(),b=f(null),U=f(),K=()=>{I("close")},V=async()=>{if(b.value)try{(await A.captionTemplate.basic.checkCaptionTemplateUse(b.value.id)).success&&(I("on-select-template-item",b.value),K())}catch(m){console.log("Fail onDoubleClickTemplateItem",m)}},q=async()=>{try{const m=await A.vizrt.basic.findConcept();if(m.success){const z=m.data,g=new DOMParser().parseFromString(z,"text/xml"),x=g.getElementsByTagName("id")[0].textContent;if(x!==null){const D=x.match(/id=(\d+)/);D&&(d.value=D[1])}w.value=Array.from(g.querySelectorAll("entry")).map(D=>{const B=D.querySelector("id").textContent;let le="";return B!==null&&(le=B.match(/dbid:(\d+)/)),{...D,conceptId:le[1],name:D.querySelector("title").textContent,label:D.querySelector("title").textContent}}),w.value.unshift({conceptId:"1",name:"All concepts",label:"All concepts"}),o.value=w.value[0]}}catch(m){console.log("Fail to get Concept select",m)}},y=async()=>{try{const m=await A.vizrt.basic.findTag();if(m.success){const z=m.data,g=new DOMParser().parseFromString(z,"text/xml");C.value=Array.from(g.querySelectorAll("feed")).map(x=>{const D=x.querySelector("id").textContent;let B="";return D!==null&&(B=D.match(/id=(\d+)/)),{...x,tagId:B[1],name:x.querySelector("title").textContent,label:x.querySelector("title").textContent}}),$.value=C.value[0]}}catch(m){console.log("Fail to get tag select",m)}},O=m=>{console.log(m),b.value=m},X=async m=>{if(b.value=m,b.value!==null)try{(await A.captionTemplate.basic.checkCaptionTemplateUse(m.id)).success&&(I("on-select-template-item",b.value),K())}catch(z){console.log("Fail onDoubleClickTemplateItem",z)}},H=()=>{U.value.getCaptionTemplateItemList()},Q=m=>{(m.key==="Escape"||m.key==="Esc")&&console.log("Esc 키가 눌렸습니다.")};return Ye(async()=>{window.addEventListener("keyup",Q),q(),y()}),(m,z)=>(u(),ae(_e,{"modal-class":"w-[90vw]","content-class":"h-[80vh]",onClose:K},{title:L(()=>[Y(h(r(c)("CaptionTemplate.itemModal.기본_템플릿_조회")),1)]),content:L(()=>[e("div",at,[e("div",lt,[e("span",ot,h(r(c)("CaptionTemplate.itemModal.VizRT_템플릿_목록")),1)]),e("div",st,[s(ue,{modelValue:o.value,"onUpdate:modelValue":z[0]||(z[0]=v=>o.value=v),class:"w-1/4","item-label":"label",options:w.value,name:"cap_tmpit_con_nm",placeholder:r(c)("CaptionTemplate.itemModal.컨셉_전체"),"is-item-label":!0,"preselect-first":!0},null,8,["modelValue","options","placeholder"]),s(ue,{modelValue:$.value,"onUpdate:modelValue":z[1]||(z[1]=v=>$.value=v),class:"w-1/4","item-label":"label",options:C.value,name:"cap_tmpit_type_nm",placeholder:r(c)("CaptionTemplate.itemModal.태그_전체"),"is-item-label":!0,"preselect-first":!0},null,8,["modelValue","options","placeholder"]),s(R,{modelValue:M.value,"onUpdate:modelValue":z[2]||(z[2]=v=>M.value=v),class:"self-end",placeholder:r(c)("CaptionTemplate.itemModal.검색어"),width:"w-72",onKeyup:be(H,["enter"])},null,8,["modelValue","placeholder"]),s(G,{class:"self-end",icon:"magnifying-glass",onClick:H})]),e("div",nt,[s(tt,{ref_key:"refCaptionTemplateItemList",ref:U,"selected-concept":o.value,"selected-tag":$.value,"search-value":M.value,onOnSelect:O,onOnDoubleClick:X},null,8,["selected-concept","selected-tag","search-value"])]),e("div",it,[s(G,{type:"secondary","button-text":r(c)("CaptionTemplate.itemModal.취소"),onClick:K},null,8,["button-text"]),s(G,{"button-text":r(c)("CaptionTemplate.itemModal.적용"),disabled:!b.value,onClick:V,onKeyup:be(V,["enter"])},null,8,["button-text","disabled"])])])]),_:1}))}}),rt={class:"flex flex-col h-full space-y-2"},dt={class:"flex flex-1 space-x-1 overflow-y-hidden"},pt={class:"flex-1 space-y-2 overflow-y-auto"},mt={class:"flex sm:text-xm text-xm font-medium text-gray-700 dark:text-white"},ut={class:"flex items-center space-x-2"},ft={class:"flex items-center justify-between sticky top-0 bg-white dark:text-white dark:bg-dark z-10"},vt={class:"sm:text-xm text-xm font-medium text-gray-700 dark:text-white"},ht={class:"space-x-3 flex items-center"},xt={class:"border border-gray-300 dark:border-slate-600 rounded-md mb-1 p-2 overflow-y-auto flex flex-col space-y-1"},gt={class:"flex items-center space-x-2"},yt={class:"flex"},bt={class:"ml-6"},_t=["id","onChange"],Tt={key:1,class:"flex items-center ml-3 justify-between relative group"},wt=["onClick"],Ct={key:0,class:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50"},kt={class:"truncate bg-white dark:bg-dark inline-block rounded-lg text-left overflow-hidden shadow-xl transform transition-all align-middle w-[40vw] relative"},It={class:"bg-gray-50 dark:bg-dark dark:text-white dark:border-dark-border border-b border-gray-200 px-4 py-3 sm:px-6 rounded-t-lg flex items-center justify-between"},$t={class:"flex space-x-4"},Vt=["src"],zt={class:"p-1 flex flex-col h-auto min-h-[250px] border border-gray-300 dark:border-slate-600 rounded-md"},Nt={key:0,class:"flex-col justify-between items-center mb-1 p-1 overflow-y-auto"},Lt={class:"flex items-center space-x-3 mb-2"},St={class:"sm:text-xs text-xs font-medium text-gray-700 dark:text-white"},Mt={class:"flex items-center space-x-2"},Ut={key:1,class:"flex-col justify-between items-center mb-1 p-1"},Ft={class:"flex items-center space-x-3 mb-2"},At={class:"sm:text-xs text-xs font-medium text-gray-700 dark:text-white"},Dt={class:"flex items-center space-x-2"},Yt={key:0,class:"flex flex-col space-y-2 items-center bg-gray rounded-md pt-12"},jt={class:"flex items-center justify-center w-full"},qt={class:"w-1/3 border border-gray-300 dark:border-slate-600 rounded-md p-2 overflow-y-auto space-y-2"},Gt={class:"flex flex-col h-full"},Rt={class:"dark:text-dark-gray-200 text-gray-800 flex justify-between"},Ot={class:"text-orange-500 self-end"},Wt={key:0,class:"flex gap-2 mt-2 justify-between items-center"},Bt={class:"w-full dark:text-white items-center"},Pt={key:0,class:"flex flex-col space-y-2 items-center bg-gray rounded-md pt-64"},Kt={class:"flex items-center justify-center w-full"},Xt={class:"space-x-3 flex items-center justify-end"},Ht=ne({__name:"CaptionTemplateModal",emits:["close","on-create"],setup(E,{emit:j}){const I=j,{t:c}=ve(),M=pe(),A=f(!1),d=f({name:"",explain:"",vizrtTemplateName:"",vizrtTemplateId:"",thumbNailIsShow:!1,captionTmpltItemGroupList:[]}),w=f([]),o=f([{attachmentFile:"",thumbNailIsShow:!1,name:"",attachmentFileId:null,ord:0,captionTmpltItemList:[]}]),C=f([]),$=f(!1),b=f(!1),U=ke({name:me(d.value,"name"),vizrtTemplateId:me(d.value,"vizrtTemplateId")}),{pass:K}=Ie(U,Se.rules),V="http://192.168.1.11:9000/api/files",q=()=>{o.value.push({attachmentFile:"",name:"",attachmentFileId:null,ord:0,thumbNailIsShow:!1,captionTmpltItemList:[]})},y=async(a,t)=>{const n=a.target,l=n.files?n.files[0]:null;if(l)try{const i=await D(l);i&&(o.value[t]={...o.value[t],attachmentFile:i,attachmentFileId:i.id})}catch(i){console.log("Failed to upload file",i)}},O=a=>{const t=document.getElementById(`fileInputs${a}`);t&&t.click()},X=a=>{b.value=!0,o.value[a]={...o.value[a],thumbNailIsShow:!0}},H=a=>{b.value=!1,o.value[a]={...o.value[a],thumbNailIsShow:!1}},Q=a=>{o.value[a]={...o.value[a],thumbNailIsShow:!1,attachmentFile:null}},m=a=>{o.value.length!==1&&o.value.splice(a,1)},z=(a,t)=>{const n=o.value[t].captionTmpltItemList;o.value[t].captionTmpltItemList=n.filter(l=>l.vizrtTemplateItemId!==a)},v=(a,t)=>{const n=o.value[t].captionTmpltItemList;o.value[t].captionTmpltItemList=n.map(l=>l.vizrtTemplateItemId===a?{...l,hiddenYn:!l.hiddenYn}:l)},g=()=>{A.value=!0},x=async a=>{d.value={...d.value,vizrtTemplateName:a.title,vizrtTemplateId:a.id,name:"",explain:"",thumbNailIsShow:!1,captionTmpltItemGroupList:[]},o.value=[],C.value=[];try{const n=(await M.vizrt.basic.findOne(a.id)).data,i=new DOMParser().parseFromString(n,"text/xml");console.log(i);const P=i.querySelector("schema");if(P){const _=Array.from(P.childNodes).filter(F=>F.nodeName==="fielddef"&&F.getAttribute("name")!=="-concept-variant-choice"&&F.getAttribute("name")!=="-title"&&F.getAttribute("name")!=="-auto-generated-title"),S=[];_.forEach(F=>{const J=F.querySelector("choice");let oe=[],ie=F.getAttribute("label")||""||null,ee=!1;J&&(ie=J.getAttribute("label"),ee=!0,oe=Array.from(J.getElementsByTagName("alternative")).map(Z=>{var ce;const ye=((ce=Z.querySelector("value"))==null?void 0:ce.textContent)??"";return{label:Z.getAttribute("label"),value:ye}}));const xe={vizrtTemplateItemId:F.getAttribute("name"),vizrtTemplateItemLabel:`${F.getAttribute("name")}${F.getAttribute("label")!==null?`(${F.getAttribute("label")})`:""}`,name:`${F.getAttribute("name")}(${F.getAttribute("label")})`,label:ie,vizrtTemplateItemMediaType:te.isEmpty(oe)?F.getAttribute("mediatype"):"select",captionTemplateItemTypeCode:"single_line",hiddenYn:ee,choice:oe};S.push(xe)}),console.log("Items without choice:",S),w.value=S,q()}}catch(t){console.log("Fail",t)}},D=async a=>{const t={file:a,publicYn:"Y",fileDivisionCode:Me.CaptionTemplate.id};try{const n=await M.file.basic.upload(t);if(n.success)return n.data}catch(n){console.log("Fail to upload file",n)}},B=async()=>{const a=await Promise.all(o.value.map(async(n,l)=>{if(te.isEmpty(n.name))throw window.Notify.error({message:"구분명을 입력해 주세요"}),new Error("구분명이 비어 있습니다.");return{...n,ord:l+1,captionTmpltItemList:n.captionTmpltItemList.map((i,P)=>({label:i.label,lineTextLimit:i.lineTextLimit,vizrtTemplateItemId:i.vizrtTemplateItemId,vizrtTemplateItemMediaType:i.vizrtTemplateItemMediaType,vizrtTemplateItemLabel:i.vizrtTemplateItemLabel,defaultValue:typeof i.defaultValue=="object"?i.defaultValue.value:i.defaultValue,hiddenYn:i.hiddenYn?"Y":"N",captionTemplateItemTypeCode:i.captionTemplateItemTypeCode,ord:P+1}))}})),t={name:d.value.name,explain:d.value.explain,vizrtTemplateId:te.toInteger(d.value.vizrtTemplateId),vizrtTemplateName:d.value.vizrtTemplateName,captionTmpltItemGroupList:a};try{(await M.captionTemplate.basic.createCaptionTemplate(t)).success&&(window.Notify.success({message:"[자막 템플릿 생성] 완료되었습니다."}),I("on-create"))}catch{window.Notify.error({message:"[자막 템플릿 생성] 실패했습니다."})}},le=a=>{window.Notify.error({message:a})},he=()=>{b.value||I("close")},p=$e(()=>w.value.filter(a=>!a.name.startsWith("-concept-variant-choice")&&!a.name.startsWith("-title")&&!a.name.startsWith("-auto-generated-title")).length);return Ve(()=>{U.name=d.value.name,U.vizrtTemplateId=d.value.vizrtTemplateId}),fe(async()=>{}),(a,t)=>(u(),ae(_e,{"modal-class":"w-[70vw] relative","content-class":"h-[90vh]",onClose:he},{title:L(()=>[Y(h(r(c)("CaptionTemplate.infoModal.템플릿_등록")),1)]),content:L(()=>[e("div",rt,[e("div",dt,[e("div",pt,[e("span",mt,h(r(c)("CaptionTemplate.infoModal.기본_정보")),1),e("div",ut,[s(R,{modelValue:d.value.vizrtTemplateName,"onUpdate:modelValue":t[0]||(t[0]=n=>d.value.vizrtTemplateName=n),class:"flex-1",readonly:"","auto-complete":!1,placeholder:r(c)("CaptionTemplate.infoModal.선택된_템플릿_컨셉이_없습니다"),disabled:!0},null,8,["modelValue","placeholder"]),s(G,{class:"self-end",icon:"squares-2X2",onClick:g})]),s(R,{modelValue:d.value.name,"onUpdate:modelValue":t[1]||(t[1]=n=>d.value.name=n),required:!0,label:r(c)("CaptionTemplate.infoModal.템플릿_이름")},null,8,["modelValue","label"]),s(ze,{modelValue:d.value.explain,"onUpdate:modelValue":t[2]||(t[2]=n=>d.value.explain=n),rows:3,label:r(c)("CaptionTemplate.infoModal.설명")},null,8,["modelValue","label"]),e("div",ft,[e("span",vt,h(`자막 구성 (${o.value.length})`),1),e("div",ht,[s(G,{class:"self-end",icon:"plus",onClick:q})])]),s(r(se),{list:o.value,handle:".handle","item-key":"id",group:{name:"items",pull:!1,put:!1}},{item:L(({element:n,index:l})=>[e("div",xt,[e("div",gt,[s(N,{class:"cursor-grab handle dark:text-white",size:"w-4 h-4",icon:"ellipsis-vertical"}),s(R,{modelValue:n.name,"onUpdate:modelValue":i=>n.name=i,class:"flex-1","auto-complete":!1,placeholder:r(c)("CaptionTemplate.infoModal.구분명을_입력해_주세요")},null,8,["modelValue","onUpdate:modelValue","placeholder"]),s(N,{icon:"x-mark",class:"cursor-pointer dark:text-white",size:"w-6 h-6",onClick:i=>m(l)},null,8,["onClick"])]),e("div",yt,[n.attachmentFile?(u(),T("div",Tt,[t[7]||(t[7]=e("span",{class:"text-white"},"썸네일: ",-1)),e("a",{href:"#",class:"text-blue-500 hover:text-blue-700 underline relative",onClick:i=>X(l)},h(n.attachmentFile.fileNm),9,wt),n.attachmentFile&&n.attachmentFile.fileUrl&&n.thumbNailIsShow?(u(),T("div",Ct,[e("div",kt,[e("div",It,[t[6]||(t[6]=e("h3",{id:"headlessui-dialog-title-6","data-headlessui-state":"open",class:"truncate text-base font-semibold leading-6",style:{border:"none","user-select":"none","-webkit-user-drag":"none"}}," 미리보기 ",-1)),e("div",$t,[s(N,{icon:"x-mark",class:"cursor-pointer dark:text-white",size:"w-5 h-5",onClick:i=>H(l)},null,8,["onClick"])])]),e("img",{src:`${V}/${n.attachmentFile.fileUrl}`,alt:"미리보기 이미지",class:"w-full h-auto object-contain"},null,8,Vt)])])):W("",!0),s(N,{icon:"x-mark",class:"cursor-pointer dark:text-white",size:"w-4 h-4",onClick:i=>Q(l)},null,8,["onClick"])])):(u(),T(de,{key:0},[e("div",bt,[s(G,{onClick:i=>O(l)},{default:L(()=>[Y(h(r(c)("CaptionTemplate.infoModal.썸네일_등록")),1)]),_:2},1032,["onClick"])]),e("input",{id:"fileInputs"+l,"aria-label":"sumnailFile",type:"file",accept:"image/*",style:{display:"none"},onChange:i=>y(i,l)},null,40,_t)],64))]),e("div",zt,[s(r(se),{list:n.captionTmpltItemList,"ghost-class":"bg-primary-50","drag-class":"bg-primary-50",handle:".handle","item-key":"id",group:{name:"items",pull:!1,put:(i,P,k)=>{const _=k.__draggable_context.element,S=n.captionTmpltItemList.some(F=>F.vizrtTemplateItemId===_.vizrtTemplateItemId);return S&&($.value||(le("이미 존재하는 아이템이 있습니다"),$.value=!0)),!S}},class:"h-full"},{item:L(({element:i,index:P})=>{var k;return[((k=i.choice)==null?void 0:k.length)===0?(u(),T("div",Nt,[e("div",Lt,[s(N,{class:"cursor-grab handle dark:text-white",size:"w-4 h-4",icon:"ellipsis-vertical"}),e("span",St,h(i.vizrtTemplateItemLabel),1),s(Ne,{id:`isRadioGroup${P}`,modelValue:i.captionTemplateItemTypeCode,"onUpdate:modelValue":_=>i.captionTemplateItemTypeCode=_,"track-by":"typeName","value-key":"typeId",options:[{typeId:"single_line",typeName:"Single"},{typeId:"multi_line",typeName:"Multi"},{typeId:"radio_select",typeName:"Radio"},{typeId:"image_select",typeName:"Image"}]},null,8,["id","modelValue","onUpdate:modelValue"])]),e("div",Mt,[s(R,{modelValue:i.label,"onUpdate:modelValue":_=>i.label=_,class:"flex-1","auto-complete":!1,placeholder:r(c)("CaptionTemplate.infoModal.구분명을_입력해_주세요")},null,8,["modelValue","onUpdate:modelValue","placeholder"]),s(R,{modelValue:i.defaultValue,"onUpdate:modelValue":_=>i.defaultValue=_,class:"flex-1","auto-complete":!1,placeholder:r(c)("CaptionTemplate.infoModal.기본값(선택)")},null,8,["modelValue","onUpdate:modelValue","placeholder"]),i.captionTemplateItemTypeCode!=="radio_select"&&i.captionTemplateItemTypeCode!=="image_select"?(u(),T(de,{key:0},[s(R,{modelValue:i.lineTextLimit,"onUpdate:modelValue":_=>i.lineTextLimit=_,class:"w-12","auto-complete":!1,placeholder:"00"},null,8,["modelValue","onUpdate:modelValue"]),t[8]||(t[8]=e("span",null,"자로 제한",-1))],64)):W("",!0),s(N,{icon:i.hiddenYn?"eye-slash":"eye",class:"cursor-pointer dark:text-white",size:"w-[20px] h-[20px]",onClick:_=>v(i.vizrtTemplateItemId,l)},null,8,["icon","onClick"]),s(N,{icon:"x-mark",class:"cursor-pointer dark:text-white",size:"w-[20px] h-[20px]",onClick:_=>z(i.vizrtTemplateItemId,l)},null,8,["onClick"])])])):(u(),T("div",Ut,[e("div",Ft,[e("span",At,h(i.vizrtTemplateItemLabel),1)]),e("div",Dt,[s(R,{modelValue:i.label,"onUpdate:modelValue":_=>i.label=_,class:"flex-1","auto-complete":!1,placeholder:r(c)("CaptionTemplate.infoModal.구분명을_입력해_주세요")},null,8,["modelValue","onUpdate:modelValue","placeholder"]),s(ue,{modelValue:i.defaultValue,"onUpdate:modelValue":_=>i.defaultValue=_,class:"w-1/4","item-label":"label",options:i.choice,name:"cap_tmpit_type_nm",placeholder:r(c)("CaptionTemplate.itemModal.태그_전체"),"is-item-label":!0,"preselect-first":!0,"allow-empty":!1},null,8,["modelValue","onUpdate:modelValue","options","placeholder"]),s(N,{icon:i.hiddenYn?"eye-slash":"eye",class:"cursor-pointer dark:text-white",size:"w-[20px] h-[20px]",onClick:_=>v(i.vizrtTemplateItemId,l)},null,8,["icon","onClick"]),s(N,{icon:"x-mark",class:"cursor-pointer dark:text-white",size:"w-[20px] h-[20px]",onClick:_=>z(i.vizrtTemplateItemId,l)},null,8,["onClick"])])]))]}),footer:L(()=>[n.captionTmpltItemList.length?W("",!0):(u(),T("div",Yt,[e("div",jt,[s(Le,{class:"w-16 h-16"})]),t[9]||(t[9]=e("div",{class:"font-D2CodingBold text-xs text-gray-400 text-center"},[Y(" 우측 목록에서 드래그 & 드롭하여 "),e("br"),Y("아이템을 추가해 주세요. ")],-1))]))]),_:2},1032,["list","group"])])])]),_:1},8,["list"])]),e("div",qt,[e("div",Gt,[e("div",Rt,[Y(h(r(c)("CaptionTemplate.infoModal.아이템_목록"))+" ",1),e("span",Ot,h(p.value)+" items ",1)]),s(r(se),{tag:"div",list:w.value,class:"mt-3 flex gap-2 flex-col dark:text-white",disabled:!1,"item-key":"id",handle:".handle",group:{name:"items",pull:"clone",put:!0},sort:!1,onEnd:t[3]||(t[3]=n=>$.value=!1)},{item:L(({element:n})=>[!n.name.startsWith("-concept-variant-choice")&&!n.name.startsWith("-title")&&!n.name.startsWith("-auto-generated-title")?(u(),T("div",Wt,[s(N,{class:"cursor-grab handle dark:text-white",size:"w-6 h-6",icon:"folder"}),e("span",Bt,h(n.name),1)])):W("",!0)]),footer:L(()=>[w.value.length?W("",!0):(u(),T("div",Pt,[e("div",Kt,[s(N,{class:"dark:text-white",size:"w-8 h-8",icon:"squares-2X2"})]),t[10]||(t[10]=e("div",{class:"font-D2CodingBold text-xs text-gray-400 text-center"},[Y(" 기본 정보에서 템플릿 컨셉을"),e("br"),Y(" 선택해 주세요. ")],-1))]))]),_:1},8,["list"])])])]),e("div",Xt,[s(G,{type:"secondary",onClick:t[4]||(t[4]=n=>a.$emit("close"))},{default:L(()=>[Y(h(r(c)("CaptionTemplate.infoModal.취소")),1)]),_:1}),s(G,{disabled:!r(K),onClick:B},{default:L(()=>[Y(h(r(c)("CaptionTemplate.infoModal.등록하기")),1)]),_:1},8,["disabled"])])]),A.value?(u(),ae(ct,{key:0,onClose:t[5]||(t[5]=n=>A.value=!1),onOnSelectTemplateItem:x})):W("",!0)]),_:1}))}}),Qt={class:"flex flex-col h-full space-y-2"},Jt={class:"flex flex-1 space-x-1 overflow-y-hidden"},Zt={class:"flex-1 space-y-2 overflow-y-auto"},Et={class:"flex sm:text-xm text-xm font-medium text-gray-700 dark:text-white"},ea={class:"flex items-center space-x-2"},ta={class:"flex items-center justify-between sticky top-0 bg-white dark:text-white dark:bg-dark z-10"},aa={class:"sm:text-xm text-xm font-medium text-gray-700 dark:text-white"},la={class:"space-x-3 flex items-center"},oa={class:"border border-gray-300 dark:border-slate-600 rounded-md mb-1 p-2 overflow-y-auto flex flex-col space-y-1"},sa={class:"flex items-center space-x-2"},na={class:"flex"},ia={class:"ml-6"},ca=["id","onChange"],ra={key:1,class:"flex items-center ml-3 justify-between relative group"},da=["onClick"],pa={key:0,class:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50"},ma={class:"truncate bg-white dark:bg-dark inline-block rounded-lg text-left overflow-hidden shadow-xl transform transition-all align-middle w-[40vw] relative"},ua={class:"bg-gray-50 dark:bg-dark dark:text-white dark:border-dark-border border-b border-gray-200 px-4 py-3 sm:px-6 rounded-t-lg flex items-center justify-between"},fa={class:"flex space-x-4"},va=["src"],ha={class:"p-1 flex flex-col h-auto min-h-[250px] border border-gray-300 dark:border-slate-600 rounded-md"},xa={key:0,class:"flex-col justify-between items-center mb-1 p-1 overflow-y-auto"},ga={class:"flex items-center space-x-3 mb-2"},ya={class:"sm:text-xs text-xs font-medium text-gray-700 dark:text-white"},ba={class:"flex items-center space-x-2"},_a={key:1,class:"flex-col justify-between items-center mb-1 p-1"},Ta={class:"flex items-center space-x-3 mb-2"},wa={class:"sm:text-xs text-xs font-medium text-gray-700 dark:text-white"},Ca={class:"flex items-center space-x-2"},ka={key:0,class:"flex flex-col space-y-2 items-center bg-gray rounded-md pt-12"},Ia={class:"flex items-center justify-center w-full"},$a={class:"w-1/3 border border-gray-300 dark:border-slate-600 rounded-md p-2 overflow-y-auto space-y-2"},Va={class:"flex flex-col h-full"},za={class:"dark:text-dark-gray-200 text-gray-800 flex justify-between"},Na={class:"text-orange-500 self-end"},La={key:0,class:"flex gap-2 mt-2 justify-between items-center"},Sa={class:"w-full dark:text-white items-center"},Ma={key:0,class:"flex flex-col space-y-2 items-center bg-gray rounded-md pt-64"},Ua={class:"flex items-center justify-center w-full"},Fa={class:"space-x-3 flex items-center justify-end"},Aa=ne({__name:"CaptionTemplateUpdateModal",props:{templateItem:{default:""}},emits:["close","on-update"],setup(E,{emit:j}){const I=j,{t:c}=ve(),M=E,A=pe(),d=f({name:"",explain:"",vizrtTemplateName:"",vizrtTemplateId:"",thumbNailIsShow:!1,captionTmpltItemGroupList:[]}),w=f([]),o=f([{attachmentFile:"",thumbNailIsShow:!1,name:"",attachmentFileId:null,ord:0,captionTmpltItemList:[]}]),C=f(!1),$=f(!1),b=ke({name:me(d.value,"name"),vizrtTemplateId:me(d.value,"vizrtTemplateId")}),{pass:U}=Ie(b,Se.rules),K="http://192.168.1.11:9000/api/files",V=()=>{o.value.push({attachmentFile:"",name:"",attachmentFileId:null,ord:0,thumbNailIsShow:!1,captionTmpltItemList:[]})},q=async p=>{try{const t=(await A.vizrt.basic.findOne(p)).data,i=new DOMParser().parseFromString(t,"text/xml").querySelector("schema");if(i){const k=Array.from(i.childNodes).filter(S=>S.nodeName==="fielddef"&&S.getAttribute("name")!=="-concept-variant-choice"&&S.getAttribute("name")!=="-title"&&S.getAttribute("name")!=="-auto-generated-title"),_=[];k.forEach(S=>{const F=S.querySelector("choice");let J=[],oe=S.getAttribute("label")||""||null,ie=!1;F&&(oe=F.getAttribute("label"),ie=!0,J=Array.from(F.getElementsByTagName("alternative")).map(Z=>{var ce;const ye=((ce=Z.querySelector("value"))==null?void 0:ce.textContent)??"";return{label:Z.getAttribute("label"),value:ye}}));const ee=S.getAttribute("name");o.value.forEach(ge=>{ge.captionTmpltItemList.forEach(Z=>{Z.vizrtTemplateItemId===ee&&(Z.choice=J)})});const xe={vizrtTemplateItemId:ee,vizrtTemplateItemLabel:`${ee}${S.getAttribute("label")!==null?`(${S.getAttribute("label")})`:""}`,name:`${ee}(${S.getAttribute("label")})`,label:oe,vizrtTemplateItemMediaType:te.isEmpty(J)?S.getAttribute("mediatype"):"select",captionTemplateItemTypeCode:"single_line",defaultValue:"",hiddenYn:ie,choice:J};_.push(xe)}),console.log("Items without choice:",_),w.value=_}}catch(a){console.log("Fail",a)}},y=async()=>{try{const p=await A.captionTemplate.basic.findOne(M.templateItem.id);p.success&&(Object.assign(d.value,p.data),o.value=p.data.captionTmpltItemGroupList.map(a=>{const t=a.captionTmpltItemList.map(n=>({...n,hiddenYn:n.hiddenYn==="Y"}));return{...a,captionTmpltItemList:t}}),te.isEmpty(o.value)&&V(),await q(M.templateItem.vizrtTemplateId))}catch(p){console.error("getCaptionTemplate Error",p)}},O=async(p,a)=>{const t=p.target,n=t.files?t.files[0]:null;if(n)try{const l=await x(n);l&&(o.value[a]={...o.value[a],attachmentFile:l,attachmentFileId:l.id})}catch(l){console.log("Failed to upload file",l)}},X=p=>{const a=document.getElementById(`fileInputs${p}`);a&&a.click()},H=p=>{$.value=!0,o.value[p]={...o.value[p],thumbNailIsShow:!0}},Q=p=>{$.value=!1,o.value[p]={...o.value[p],thumbNailIsShow:!1}},m=p=>{o.value[p]={...o.value[p],thumbNailIsShow:!1,attachmentFile:null}},z=p=>{o.value.length!==1&&o.value.splice(p,1)},v=(p,a)=>{const t=o.value[a].captionTmpltItemList;o.value[a].captionTmpltItemList=t.filter(n=>n.vizrtTemplateItemId!==p)},g=(p,a)=>{const t=o.value[a].captionTmpltItemList;o.value[a].captionTmpltItemList=t.map(n=>n.vizrtTemplateItemId===p?{...n,hiddenYn:!n.hiddenYn}:n)},x=async p=>{const a={file:p,publicYn:"Y",fileDivisionCode:Me.CaptionTemplate.id};try{const t=await A.file.basic.upload(a);if(t.success)return t.data}catch(t){console.log("Fail to upload file",t)}},D=async()=>{const p=await Promise.all(o.value.map(async(t,n)=>{if(te.isEmpty(t.name))throw window.Notify.error({message:"구분명을 입력해 주세요"}),new Error("구분명이 비어 있습니다.");return{...t,ord:n+1,captionTmpltItemList:t.captionTmpltItemList.map((l,i)=>({label:l.label,lineTextLimit:l.lineTextLimit,vizrtTemplateItemId:l.vizrtTemplateItemId,vizrtTemplateItemMediaType:l.vizrtTemplateItemMediaType,vizrtTemplateItemLabel:l.vizrtTemplateItemLabel,defaultValue:typeof l.defaultValue=="object"?l.defaultValue.value:l.defaultValue,hiddenYn:l.hiddenYn?"Y":"N",captionTemplateItemTypeCode:l.captionTemplateItemTypeCode,ord:i+1}))}})),a={name:d.value.name,explain:d.value.explain,vizrtTemplateId:te.toInteger(d.value.vizrtTemplateId),vizrtTemplateName:d.value.vizrtTemplateName,captionTmpltItemGroupList:p};try{(await A.captionTemplate.basic.updateCaptionTemplate(M.templateItem.id,a)).success&&(window.Notify.success({message:"[자막 템플릿 수정] 완료되었습니다."}),I("on-update"))}catch{window.Notify.error({message:"[자막 템플릿 수정] 실패했습니다."})}},B=p=>{window.Notify.error({message:p})},le=()=>{$.value||I("close")},he=$e(()=>w.value.filter(p=>!p.name.startsWith("-concept-variant-choice")&&!p.name.startsWith("-title")&&!p.name.startsWith("-auto-generated-title")).length);return Ve(()=>{b.name=d.value.name,b.vizrtTemplateId=d.value.vizrtTemplateId}),fe(async()=>{y()}),(p,a)=>(u(),ae(_e,{"modal-class":"w-[70vw] relative","content-class":"h-[90vh]",onClose:le},{title:L(()=>[Y(h(r(c)("CaptionTemplate.infoModal.템플릿_수정")),1)]),content:L(()=>[e("div",Qt,[e("div",Jt,[e("div",Zt,[e("span",Et,h(r(c)("CaptionTemplate.infoModal.기본_정보")),1),e("div",ea,[s(R,{modelValue:d.value.vizrtTemplateName,"onUpdate:modelValue":a[0]||(a[0]=t=>d.value.vizrtTemplateName=t),class:"flex-1",readonly:"","auto-complete":!1,placeholder:r(c)("CaptionTemplate.infoModal.선택된_템플릿_컨셉이_없습니다"),disabled:!0},null,8,["modelValue","placeholder"]),s(G,{class:"self-end",icon:"squares-2X2",disabled:!0})]),s(R,{modelValue:d.value.name,"onUpdate:modelValue":a[1]||(a[1]=t=>d.value.name=t),required:!0,label:r(c)("CaptionTemplate.infoModal.템플릿_이름")},null,8,["modelValue","label"]),s(ze,{modelValue:d.value.explain,"onUpdate:modelValue":a[2]||(a[2]=t=>d.value.explain=t),rows:3,label:r(c)("CaptionTemplate.infoModal.설명")},null,8,["modelValue","label"]),e("div",ta,[e("span",aa,h(`자막 구성 (${o.value.length})`),1),e("div",la,[s(G,{class:"self-end",icon:"plus",onClick:V})])]),s(r(se),{list:o.value,handle:".handle","item-key":"id",group:{name:"items",pull:!1,put:!1}},{item:L(({element:t,index:n})=>[e("div",oa,[e("div",sa,[s(N,{class:"cursor-grab handle dark:text-white",size:"w-4 h-4",icon:"ellipsis-vertical"}),s(R,{modelValue:t.name,"onUpdate:modelValue":l=>t.name=l,class:"flex-1","auto-complete":!1,placeholder:r(c)("CaptionTemplate.infoModal.구분명을_입력해_주세요")},null,8,["modelValue","onUpdate:modelValue","placeholder"]),s(N,{icon:"x-mark",class:"cursor-pointer dark:text-white",size:"w-6 h-6",onClick:l=>z(n)},null,8,["onClick"])]),e("div",na,[t.attachmentFile?(u(),T("div",ra,[a[6]||(a[6]=e("span",{class:"text-white"},"썸네일: ",-1)),e("a",{href:"#",class:"text-blue-500 hover:text-blue-700 underline relative",onClick:l=>H(n)},h(t.attachmentFile.fileNm),9,da),t.attachmentFile&&t.attachmentFile.fileUrl&&t.thumbNailIsShow?(u(),T("div",pa,[e("div",ma,[e("div",ua,[a[5]||(a[5]=e("h3",{id:"headlessui-dialog-title-6","data-headlessui-state":"open",class:"truncate text-base font-semibold leading-6",style:{border:"none","user-select":"none","-webkit-user-drag":"none"}}," 미리보기 ",-1)),e("div",fa,[s(N,{icon:"x-mark",class:"cursor-pointer dark:text-white",size:"w-5 h-5",onClick:l=>Q(n)},null,8,["onClick"])])]),e("img",{src:`${K}/${t.attachmentFile.fileUrl}`,alt:"미리보기 이미지",class:"w-full h-auto object-contain"},null,8,va)])])):W("",!0),s(N,{icon:"x-mark",class:"cursor-pointer dark:text-white",size:"w-4 h-4",onClick:l=>m(n)},null,8,["onClick"])])):(u(),T(de,{key:0},[e("div",ia,[s(G,{onClick:l=>X(n)},{default:L(()=>[Y(h(r(c)("CaptionTemplate.infoModal.썸네일_등록")),1)]),_:2},1032,["onClick"])]),e("input",{id:"fileInputs"+n,"aria-label":"sumnailFile",type:"file",accept:"image/*",style:{display:"none"},onChange:l=>O(l,n)},null,40,ca)],64))]),e("div",ha,[s(r(se),{list:t.captionTmpltItemList,"ghost-class":"bg-primary-50","drag-class":"bg-primary-50",handle:".handle","item-key":"id",group:{name:"items",pull:!1,put:(l,i,P)=>{const k=P.__draggable_context.element,_=t.captionTmpltItemList.some(S=>S.vizrtTemplateItemId===k.vizrtTemplateItemId);return _&&(C.value||(B("이미 존재하는 아이템이 있습니다"),C.value=!0)),!_}},class:"h-full"},{item:L(({element:l,index:i})=>{var P;return[((P=l.choice)==null?void 0:P.length)===0?(u(),T("div",xa,[e("div",ga,[s(N,{class:"cursor-grab handle dark:text-white",size:"w-4 h-4",icon:"ellipsis-vertical"}),e("span",ya,h(l.vizrtTemplateItemLabel),1),s(Ne,{id:`isRadioGroup${i}`,modelValue:l.captionTemplateItemTypeCode,"onUpdate:modelValue":k=>l.captionTemplateItemTypeCode=k,"track-by":"typeName","value-key":"typeId",options:[{typeId:"single_line",typeName:"Single"},{typeId:"multi_line",typeName:"Multi"},{typeId:"radio_select",typeName:"Radio"},{typeId:"image_select",typeName:"Image"}]},null,8,["id","modelValue","onUpdate:modelValue"])]),e("div",ba,[s(R,{modelValue:l.label,"onUpdate:modelValue":k=>l.label=k,class:"flex-1","auto-complete":!1,placeholder:r(c)("CaptionTemplate.infoModal.구분명을_입력해_주세요")},null,8,["modelValue","onUpdate:modelValue","placeholder"]),s(R,{modelValue:l.defaultValue,"onUpdate:modelValue":k=>l.defaultValue=k,class:"flex-1","auto-complete":!1,placeholder:r(c)("CaptionTemplate.infoModal.기본값(선택)")},null,8,["modelValue","onUpdate:modelValue","placeholder"]),l.captionTemplateItemTypeCode!=="radio_select"&&l.captionTemplateItemTypeCode!=="image_select"?(u(),T(de,{key:0},[s(R,{modelValue:l.lineTextLimit,"onUpdate:modelValue":k=>l.lineTextLimit=k,class:"w-12","auto-complete":!1,placeholder:"00"},null,8,["modelValue","onUpdate:modelValue"]),a[7]||(a[7]=e("span",null,"자로 제한",-1))],64)):W("",!0),s(N,{icon:l.hiddenYn?"eye-slash":"eye",class:"cursor-pointer dark:text-white",size:"w-[20px] h-[20px]",onClick:k=>g(l.vizrtTemplateItemId,n)},null,8,["icon","onClick"]),s(N,{icon:"x-mark",class:"cursor-pointer dark:text-white",size:"w-[20px] h-[20px]",onClick:k=>v(l.vizrtTemplateItemId,n)},null,8,["onClick"])])])):(u(),T("div",_a,[e("div",Ta,[e("span",wa,h(l.vizrtTemplateItemLabel),1)]),e("div",Ca,[s(R,{modelValue:l.label,"onUpdate:modelValue":k=>l.label=k,class:"flex-1","auto-complete":!1,placeholder:r(c)("CaptionTemplate.infoModal.구분명을_입력해_주세요")},null,8,["modelValue","onUpdate:modelValue","placeholder"]),s(ue,{modelValue:l.defaultValue,"onUpdate:modelValue":k=>l.defaultValue=k,class:"w-1/4","track-by":"value","item-label":"label",options:l.choice,name:"cap_tmpit_type_nm",placeholder:r(c)("CaptionTemplate.itemModal.태그_전체"),"is-item-label":!0,"preselect-first":!0,"allow-empty":!1},null,8,["modelValue","onUpdate:modelValue","options","placeholder"]),s(N,{disabled:"",icon:l.hiddenYn?"eye-slash":"eye",class:"dark:text-white",size:"w-[20px] h-[20px]"},null,8,["icon"]),s(N,{disabled:"",icon:"x-mark",class:"dark:text-white",size:"w-[20px] h-[20px]"})])]))]}),footer:L(()=>[t.captionTmpltItemList.length?W("",!0):(u(),T("div",ka,[e("div",Ia,[s(Le,{class:"w-16 h-16"})]),a[8]||(a[8]=e("div",{class:"font-D2CodingBold text-xs text-gray-400 text-center"},[Y(" 우측 목록에서 드래그 & 드롭하여 "),e("br"),Y("아이템을 추가해 주세요. ")],-1))]))]),_:2},1032,["list","group"])])])]),_:1},8,["list"])]),e("div",$a,[e("div",Va,[e("div",za,[Y(h(r(c)("CaptionTemplate.infoModal.아이템_목록"))+" ",1),e("span",Na,h(he.value)+" items ",1)]),s(r(se),{tag:"div",list:w.value,class:"mt-3 flex gap-2 flex-col dark:text-white",disabled:!1,"item-key":"id",handle:".handle",group:{name:"items",pull:"clone",put:!0},sort:!1,onEnd:a[3]||(a[3]=t=>C.value=!1)},{item:L(({element:t})=>[!t.name.startsWith("-concept-variant-choice")&&!t.name.startsWith("-title")&&!t.name.startsWith("-auto-generated-title")?(u(),T("div",La,[s(N,{class:"cursor-grab handle dark:text-white",size:"w-6 h-6",icon:"folder"}),e("span",Sa,h(t.name),1)])):W("",!0)]),footer:L(()=>[w.value.length?W("",!0):(u(),T("div",Ma,[e("div",Ua,[s(N,{class:"dark:text-white",size:"w-8 h-8",icon:"squares-2X2"})]),a[9]||(a[9]=e("div",{class:"font-D2CodingBold text-xs text-gray-400 text-center"},[Y(" 기본 정보에서 템플릿 컨셉을"),e("br"),Y(" 선택해 주세요. ")],-1))]))]),_:1},8,["list"])])])]),e("div",Fa,[s(G,{type:"secondary",onClick:a[4]||(a[4]=t=>p.$emit("close"))},{default:L(()=>[Y(h(r(c)("CaptionTemplate.infoModal.취소")),1)]),_:1}),s(G,{disabled:!r(U),onClick:D},{default:L(()=>[Y(h(r(c)("CaptionTemplate.infoModal.수정하기")),1)]),_:1},8,["disabled"])])])]),_:1}))}}),Da=ne({__name:"CaptionTemplateList",props:{captionTemplateList:{}},emits:["selected-row","double-clicked-row","on-toggle-use","on-draggable"],setup(E,{emit:j}){const I=j,c=o=>{const C=document.createElement("div");C.className="h-full";const $={"onUpdate:modelValue":b=>{I("on-toggle-use",{id:o.data.id,useYn:b})},modelValue:o.data.useYn===!0};return Be(Ge,$,C)},M=[{headerName:"",field:"drag",sortable:!1,maxWidth:40,rowDrag:!0},{headerName:"순번",field:"no",maxWidth:60,valueGetter:"node.rowIndex",cellRenderer:o=>qe(o)},{headerName:"템플릿 이름",field:"name",sortable:!1},{headerName:"Vizrt Concepts",field:"vizrtTemplateName",sortable:!1},{headerName:"설명",field:"explain",sortable:!1},{headerName:"등록자",field:"inputerName"},{headerName:"등록일시",field:"updateDateTime",minWidth:140},{headerName:"사용여부",field:"useYn",filter:!1,cellRenderer:o=>c(o)}],A=o=>{I("selected-row",o[0].data)},d=o=>{I("on-draggable",o)},w=o=>{I("double-clicked-row",o.data)};return(o,C)=>(u(),ae(je,{"row-data":o.captionTemplateList,"column-defs":M,"row-drag-managed":!0,onOnRowDragEnd:d,onSelectedRows:A,onDoubleClickedRow:w},null,8,["row-data"]))}}),Ya={class:"h-full"},ja={class:"flex justify-between"},qa={class:"flex space-x-2 items-center"},Ga={class:"flex items-center space-x-1.5"},Ra={class:"space-x-2"},Oa={class:"text-xl dark:text-dark-gray-200"},Wa={class:"text-xl text-gray-500"},nl=ne({__name:"CaptionTemplate",setup(E){const{t:j}=ve(),I=f(!1),c=pe(),M=f(""),A=f(1),d=f(["asc","desc"]),w=f([]),o=f(),C=f(),$=f(!1),b=f(!1),U=async()=>{const v={pageable:{page:A.value-1,size:We.sm,sort:[d.value[0]]},condition:{searchValue:""}};try{I.value=!0;const g=await c.captionTemplate.basic.findAll(v);g.success&&(w.value=g.data.content.map(x=>({...x,useYn:x.useYn==="Y"})))}catch(g){console.error("Fail to get board list",g)}finally{I.value=!1}},K=async()=>{M.value="",await U()},V=()=>{$.value=!0},q=()=>{b.value=!0},y=async()=>{try{(await c.captionTemplate.basic.deleteCaptionTemplate(o.value)).success&&(window.Notify.success({message:"[자막 템플릿 삭제] 완료되었습니다."}),await U())}catch(v){console.log("Fail to delete captionTemplate",v)}},O=async v=>{const g={useYn:v.useYn?"Y":"N"};try{(await c.captionTemplate.basic.updateCaptionTemplate(v.id,g)).success&&(window.Notify.success({message:"[자막 템플릿 수정] 완료되었습니다."}),await U())}catch(x){console.log("Fail to update captionTemplate",x)}},X=async v=>{const g={order:v.node.rowIndex};try{console.log(g),(await c.captionTemplate.basic.updateCaptionTemplateOrder(o.value,g)).success&&(window.Notify.success({message:"[자막 템플릿 수정] 완료되었습니다."}),await U())}catch(x){console.log("Fail to update caption order",x)}},H=v=>{C.value=v,o.value=v.id},Q=v=>{b.value=!0,o.value=v.id},m=async()=>{$.value=!1,await U()},z=async()=>{b.value=!1,await U()};return fe(async()=>{await U()}),(v,g)=>{var D;const x=Re("tooltip");return u(),T("div",Ya,[e("div",ja,[e("div",qa,[s(R,{modelValue:M.value,"onUpdate:modelValue":g[0]||(g[0]=B=>M.value=B),width:"w-96",placeholder:r(j)("CaptionTemplate.이름_또는_설명으로_검색하세요"),onKeyup:be(U,["enter"])},null,8,["modelValue","placeholder"]),re(s(G,{icon:"magnifying-glass",onClick:U},null,512),[[x,r(j)("CaptionTemplate.검색")]])]),e("div",Ga,[re(s(G,{icon:"arrow-path",onClick:K},null,512),[[x,r(j)("CaptionTemplate.새로고침")]]),re(s(G,{icon:"plus",disabled:I.value,onClick:V},null,8,["disabled"]),[[x,r(j)("CaptionTemplate.추가")]]),re(s(G,{icon:"pencil",disabled:I.value||!C.value,onClick:q},null,8,["disabled"]),[[x,r(j)("CaptionTemplate.수정")]]),re(s(Oe,{icon:"trash",title:(D=C.value)==null?void 0:D.bbNm,disabled:I.value||!C.value,onOnConfirm:y},null,8,["title","disabled"]),[[x,r(j)("CaptionTemplate.삭제")]])])]),e("div",Ra,[e("span",Oa,h(r(j)("CaptionTemplate.자막_템플릿")),1),e("span",Wa,h(r(j)("CaptionTemplate.게시판수",{captionTemplate:w.value.length})),1)]),s(Da,{"caption-template-list":w.value,onSelectedRow:H,onDoubleClickedRow:Q,onOnDraggable:X,onOnToggleUse:O},null,8,["caption-template-list"]),$.value?(u(),ae(Ht,{key:0,"template-item":C.value,onOnCreate:m,onClose:g[1]||(g[1]=B=>$.value=!1)},null,8,["template-item"])):W("",!0),b.value?(u(),ae(Aa,{key:1,"template-item":C.value,onOnUpdate:z,onClose:g[2]||(g[2]=B=>b.value=!1)},null,8,["template-item"])):W("",!0)])}}});export{nl as default};
