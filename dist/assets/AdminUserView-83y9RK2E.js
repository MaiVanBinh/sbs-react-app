import{d as F,k as n,c6 as me,a as p,c as M,Y as r,F as q,C as ee,h as C,aM as pe,K as $,al as De,am as Re,a6 as Le,ew as se,a5 as fe,ab as ve,aa as he,V as ce,l as S,o as ge,w as H,a0 as w,G as g,a1 as W,j as u,a2 as B,X as de,a4 as Ee,a3 as Ge,ad as We,ai as Be,L as Oe,$ as Te,aj as K,aG as Ae,ah as Z}from"./index-eLyz9_Ts.js";import{_ as Pe}from"./ConfirmButton.vue_vue_type_script_setup_true_lang-onM9evN8.js";import{u as je}from"./use-date-GeeGTbYh.js";import{r as ie}from"./use-render-component-K20sHqiA.js";import{u as ze}from"./group-jQnorhMh.js";import{_ as He}from"./GTagSelect.vue_vue_type_script_setup_true_lang-WNNVbcKh.js";import{u as Ke}from"./use-regex-PKR758aA.js";import{G as qe}from"./GRadioGroup-cHw1G1ew.js";import{_ as Fe}from"./DepartmentMultiSelect.vue_vue_type_script_setup_true_lang-OqmQVQH2.js";import"./vue-multiselect-Yz8FsF-E.js";import"./use-model-wrapper-XtiLc3Xd.js";/* empty css                                                                    */import"./department-wnuBQoCo.js";const Xe={class:"flex flex-col w-full"},Je={class:"flex flex-wrap p-1 gap-1 items-center text-xs"},Qe=F({__name:"UserAccessTag",props:{params:{default:void 0}},setup(D){const v=D,c=n();return me(()=>{const{nrsUseYn:x,samUseYn:m,mamUseYn:h,bisUseYn:k}=v.params.data;c.value=[{value:x,name:"NRS",id:"nas1"},{value:m,name:"SAM",id:"sam2"},{value:h,name:"MAM",id:"mam3"},{value:k,name:"BIS",id:"bis4"}]}),(x,m)=>(p(),M("div",Xe,[r("div",Je,[(p(!0),M(q,null,ee(c.value,h=>(p(),M(q,{key:h.id},[h.value==="Y"?(p(),C(pe,{key:0,text:h==null?void 0:h.name,color:"blue","chip-width":"w-12"},null,8,["text"])):$("",!0)],64))),128))])]))}}),Ze={class:"flex flex-col w-full"},es={class:"flex flex-wrap p-1 gap-1 items-center"},ss=F({__name:"GroupTag",props:{params:{default:void 0}},setup(D){const v=D,c=n();return me(()=>{v.params.data.userGroups.length&&(c.value=v.params.data.userGroups.map(x=>x))}),(x,m)=>(p(),M("div",Ze,[r("div",es,[(p(!0),M(q,null,ee(c.value,h=>(p(),C(pe,{key:h.groupId,text:h==null?void 0:h.groupName,color:"primary"},null,8,["text"]))),128))])]))}}),as=F({__name:"UserList",props:{isLoading:{type:Boolean},rowData:{},pageInfo:{}},emits:["selected-rows","double-clicked-row","on-change-page","on-toggle-use","on-toggle-mfa","on-toggle-multi-login"],setup(D,{emit:v}){const c=v,{formatDate:x}=je(),m=e=>{const U=document.createElement("div");U.className="h-full";const d={"onUpdate:modelValue":t=>{c("on-toggle-multi-login",{user:e.data,multiLoginYn:t})},modelValue:e.data.multiLoginYn==="Y"};return ie(se,d,U)},h=e=>{const U=document.createElement("div");U.className="h-full";const d={"onUpdate:modelValue":t=>{c("on-toggle-use",{user:e.data,useYn:t})},modelValue:e.data.useYn==="Y"};return ie(se,d,U)},k=e=>{const{data:U}=e,d={type:"normal",text:"등록중"};U.delDtm&&(d.type="delete",d.text="삭제됨");const t="h-6 w-[4.25rem] flex justify-center items-center text-center whitespace-nowrap px-2 py-1 rounded-full ";return`<div class="text-xs ${{delete:"text-gray-600",blocked:"text-red-600",normal:`${t} bg-emerald-700 text-emerald-100`,apply:`${t} bg-emerald-100 text-emerald-700`}[d.type]}">${d.text}</div>`},P=[{headerName:"순번",filter:!1,maxWidth:60,valueGetter:"node.rowIndex",cellRenderer:e=>Re(e)},{headerName:"소속",filter:!1,maxWidth:150,cellRenderer:e=>e.data.userChannels[0].channelName},{headerName:"이름",field:"userNm",filter:!1,maxWidth:160},{headerName:"ID/사원번호",field:"userId",filter:!1,maxWidth:160},{headerName:"이메일",field:"email",filter:!1,maxWidth:260,cellRendererParams:{size:"w-7 h-7"},cellStyle:{textAlign:"center",verticalAlign:"middle"},cellClass:""},{headerName:"부서",field:"deptNm",filter:!1,maxWidth:160},{headerName:"상태",filter:!1,minWidth:100,maxWidth:100,cellRenderer:e=>k(e)},{headerName:"그룹",field:"",autoHeight:!0,minWidth:200,cellRenderer:ss},{headerName:"서비스 접근 권한",autoHeight:!0,minWidth:200,cellRenderer:Qe},{headerName:"기기등록",field:"mobileUseYn",maxWidth:100,cellRenderer:e=>e.value==="N"?"":ie(Le,{icon:"check-circle",size:"w-5 h-5 text-blue-700"},document.createElement("span"))},{headerName:"등록일시",field:"inputDtm",filter:!1,maxWidth:260,valueGetter:e=>x(e.data.inputDtm,"YYYY-MM-DD HH:mm:ss")},{headerName:"중복 로그인",field:"multiLoginYn",filter:!1,maxWidth:150,cellRenderer:e=>m(e)},{headerName:"사용여부",field:"useYn",filter:!1,maxWidth:150,cellRenderer:e=>h(e)}],b=e=>{c("selected-rows",e)},_=e=>{c("double-clicked-row",e)},y=e=>{c("on-change-page",e)};return(e,U)=>(p(),C(De,{class:"w-full h-full flex flex-col","column-defs":P,"row-data":e.rowData,"is-loading":e.isLoading,filter:!1,sortable:!1,"page-info":e.pageInfo,"suppress-movable":!1,"row-selection":"single",onSelectedRows:b,onDoubleClickedRow:_,onOnChangePage:y},null,8,["row-data","is-loading","page-info"]))}}),ls={class:""},ts={class:"px-2 py-4 space-y-6"},os={class:"space-y-2 text-sm"},ns={class:"text-xs mb-2"},rs={class:"mt-2 text-xs text-red-600"},ds={class:"flex space-x-2 w-full items-end"},is={class:"mt-2 text-xs text-red-600"},us={class:"flex flex-col space-y-1"},cs={class:"flex text-xs font-medium text-gray-700 dark:text-white"},ms={class:"flex space-x-2"},ps={class:"text-xs"},fs={class:"flex flex-col space-y-1"},vs={class:"flex text-xs font-medium text-gray-700 dark:text-white"},hs={class:"flex space-x-2"},gs={class:"text-xs"},Us={class:"space-x-3 flex items-center justify-end"},xs=F({__name:"UserCreateModal",props:{userMngId:{default:0},mode:{default:"create"}},emits:["on-create","on-edit","close"],setup(D,{emit:v}){const c=D,x=v,{t:m}=fe(),{companyId:h}=ve(),k=he(),P=ze(),{emailPattern:b}=Ke(),{fetchUser:_}=k,{fetchGroups:y}=P,e=n(""),U=n(""),d=n(""),t=n(""),V=n(""),R=n(""),f=n(!0),O=n([]),I=n(),X=n([]),T=n(""),j=n(!1),L=n(!1),J=n(!1),ae=n(null),z=n(h),le=n([]);let Y=ce({isNrsUseYn:!1,isSamUseYn:!1,isMamUseYn:!1,isBisUseYn:!1});const E=ce({isMultiLoginYn:{value:!1,text:"중복 로그인"},isUseYn:{value:!1,text:"사용여부"}}),te=async()=>{try{j.value=!0;const a=await y({isUse:!0,size:1e4});a.success&&(X.value=a.data.content.map(s=>({...s,isChecked:!1})))}catch(o){console.error("UserCreateModal getGroups() Error",o)}finally{j.value=!1}},oe=async()=>{try{const o=await _(c.userMngId);if(o.success){const{userId:a,userNm:s,email:G,phoneNumber:be,userChannels:ue,userGroups:Ce,nrsUseYn:ye,samUseYn:Ye,mamUseYn:Me,bisUseYn:Ve,multiLoginYn:Ne,useYn:ke,deptId:Ie,deptNm:$e,rmk:Se}=o.data;e.value=a,U.value=s,V.value=G,R.value=be,I.value=[{departmentId:Ie,departmentName:$e}],le.value=ue,z.value=ue[0].channelId,O.value=Ce,Y={isNrsUseYn:ye==="Y",isSamUseYn:Ye==="Y",isMamUseYn:Me==="Y",isBisUseYn:Ve==="Y"},E.isUseYn.value=ke==="Y",E.isMultiLoginYn.value=Ne==="Y",T.value=Se}}catch(o){console.error("UserCreateModal: getUser() Error",o)}},l=()=>{x("close")},i=async()=>{var o;try{L.value=!0;const a=O.value.map(G=>G.groupId),s={channelId:h,userId:e.value.trim(),userName:U.value.trim(),password:d.value.trim(),email:V.value,phoneNumber:R.value,departmentId:(o=I.value[0])==null?void 0:o.departmentId,userGroupIdList:a,isReporter:!0,isMultiLoginYn:E.isMultiLoginYn.value,isUsing:E.isUseYn.value,isMfaUseYn:!0,isMobileUseYn:!0,isNrsUseYn:Y.isNrsUseYn,isSamUseYn:Y.isSamUseYn,isMamUseYn:Y.isMamUseYn,isBisUseYn:Y.isBisUseYn,rmk:T.value};c.mode==="create"?x("on-create",s):x("on-edit",s)}catch(a){console.error("UserCreateModal onSubmit() Error",a)}finally{L.value=!1}},N=S(()=>c.mode==="create"?m("Modal.User.CreateModal.사용자_추가"):m("Modal.User.CreateModal.사용자_수정")),A=S(()=>c.mode==="create"?m("Modal.User.CreateModal.추가"):m("Modal.User.CreateModal.수정")),ne=S(()=>c.mode==="edit"),Q=S(()=>d.value!==t.value?"비밀번호가 일치하지 않습니다.":""),re=S(()=>{let o=!1;return c.mode==="create"&&(o=d.value!==""&&d.value===t.value),c.mode==="edit"&&(o=d.value===t.value,f.value&&(o=d.value!==""&&d.value===t.value)),V.value?o=b(V.value):R.value&&(o=J.value),o}),Ue=()=>{f.value=!f.value,f.value||(d.value="",t.value="")},xe=o=>{J.value=o.completed},_e=o=>{console.log(o,"현재 값 저장 안됨 나중에 변경 하거나 id만 쓸거면 지워도됨")},we=o=>{I.value=o};return ge(()=>{te(),c.mode==="edit"&&(f.value=!1,oe())}),(o,a)=>(p(),C(Ge,{"modal-class":"sm:w-1/2 2xl:w-[25vw]",onClose:l},{title:H(()=>[r("span",ls,w(N.value),1)]),content:H(()=>[r("div",ts,[r("div",os,[r("div",ns,[g(qe,{modelValue:z.value,"onUpdate:modelValue":a[0]||(a[0]=s=>z.value=s),label:"소속","track-by":"channelName","value-key":"channelId",options:[{channelId:1,channelName:"SBS뉴스TV"},{channelId:2,channelName:"SBS뉴스"},{channelId:3,channelName:"외주 사용자"}],onChange:_e},null,8,["modelValue"])]),g(W,{modelValue:e.value,"onUpdate:modelValue":a[1]||(a[1]=s=>e.value=s),name:"userId",label:u(m)("Modal.User.CreateModal.아이디"),required:"",disabled:ne.value},null,8,["modelValue","label","disabled"]),r("span",rs,w(ae.value),1),g(W,{modelValue:U.value,"onUpdate:modelValue":a[2]||(a[2]=s=>U.value=s),name:"userNm",label:u(m)("Modal.User.CreateModal.이름")},null,8,["modelValue","label"]),r("div",ds,[g(W,{modelValue:d.value,"onUpdate:modelValue":a[3]||(a[3]=s=>d.value=s),name:"password",class:"w-full",label:u(m)("Modal.User.CreateModal.비밀번호"),type:"password",required:"",placeholder:f.value?"":"*****",disabled:!f.value},null,8,["modelValue","label","placeholder","disabled"]),o.mode==="edit"?(p(),C(B,{key:0,class:"h-[2.15rem]",onClick:Ue},{default:H(()=>[de(w(f.value?"재설정 취소":"재설정"),1)]),_:1})):$("",!0)]),o.mode==="create"||o.mode==="edit"&&f.value?(p(),C(W,{key:0,modelValue:t.value,"onUpdate:modelValue":a[4]||(a[4]=s=>t.value=s),label:u(m)("Modal.User.CreateModal.비밀번호_확인"),type:"password",name:"pwdConfirm",required:""},null,8,["modelValue","label"])):$("",!0),r("span",is,w(Q.value),1),g(W,{modelValue:V.value,"onUpdate:modelValue":a[5]||(a[5]=s=>V.value=s),label:u(m)("Modal.User.CreateModal.이메일"),type:"email",name:"email"},null,8,["modelValue","label"]),g(Ee,{modelValue:R.value,"onUpdate:modelValue":a[6]||(a[6]=s=>R.value=s),label:"연락처","mask-format":"###-####-####",placeholder:"000-0000-0000",onMaska:xe},null,8,["modelValue"]),g(Fe,{"selected-departments":I.value,"onUpdate:selectedDepartments":a[7]||(a[7]=s=>I.value=s),"use-multi-select":!1,onOnSelectedDepartment:we},null,8,["selected-departments"]),g(He,{modelValue:O.value,"onUpdate:modelValue":a[8]||(a[8]=s=>O.value=s),options:X.value,"track-by":"groupId",label:"groupName","item-label":u(m)("Modal.User.CreateModal.그룹"),"is-loading":j.value},null,8,["modelValue","options","item-label","is-loading"]),g(W,{modelValue:T.value,"onUpdate:modelValue":a[9]||(a[9]=s=>T.value=s),name:"rmk",label:u(m)("Modal.User.CreateModal.비고"),placeholder:"비고 내용 입력"},null,8,["modelValue","label"]),r("div",us,[r("span",cs,w(u(m)("Modal.User.CreateModal.서비스_접근_권한")),1),r("div",ms,[(p(!0),M(q,null,ee(Object.keys(u(Y)),s=>(p(),M("div",{key:`${s}`,class:"flex space-x-1 items-center"},[g(se,{modelValue:u(Y)[s],"onUpdate:modelValue":G=>u(Y)[s]=G},null,8,["modelValue","onUpdate:modelValue"]),r("p",ps,w(s.replace("is","").replace("UseYn","").toUpperCase()),1)]))),128))])]),r("div",fs,[r("span",vs,w(u(m)("Modal.User.CreateModal.이용_설정")),1),r("div",hs,[(p(!0),M(q,null,ee(Object.values(E),s=>(p(),M("div",{key:`${s}`,class:"flex space-x-1 items-center"},[g(se,{modelValue:s.value,"onUpdate:modelValue":G=>s.value=G},null,8,["modelValue","onUpdate:modelValue"]),r("p",gs,w(s.text),1)]))),128))])])]),r("div",Us,[g(B,{type:"secondary",onClick:a[10]||(a[10]=s=>o.$emit("close"))},{default:H(()=>[de(w(u(m)("Modal.User.CreateModal.취소")),1)]),_:1}),g(B,{loading:L.value,disabled:!re.value,onClick:i},{default:H(()=>[de(w(A.value),1)]),_:1},8,["loading","disabled"])])])]),_:1}))}}),_s={class:"h-full"},ws={class:"flex justify-between"},bs={class:"flex items-center space-x-2"},Cs={class:"space-x-2 w-[210px]"},ys={class:"text-xl dark:text-dark-gray-200"},Ys={class:"text-xl text-gray-500"},Ms={class:"pl-3"},Vs={class:"space-x-1.5"},Ns={class:"flex flex-col h-full"},As=F({__name:"AdminUserView",setup(D){const{t:v}=fe(),{companyId:c}=ve(),x=he(),{fetchUsers:m,createUser:h,updateUser:k,deleteUser:P}=x,b=n(!1),_=n(!1),y=n(!1),e=n(""),U=n("create"),d=n([]),t=n(),V=n(We.sm),R=n({isShow:!1,page:1,totalElements:1,totalPages:1,numberOfElements:1,size:V.value}),f=async()=>{try{b.value=!0;const l={chDivId:c,searchValue:e.value,delYn:_.value?"Y":"N",size:1e4},i=await m(l);i.success&&(d.value=i.data.content)}catch(l){console.log("AdminUserView: getUsers() Error",l)}finally{b.value=!1}},O=()=>{U.value="create",y.value=!0},I=()=>{U.value="edit",y.value=!0},X=l=>{t.value=l[0].data},T=l=>{t.value=l.data,I()},j=l=>{_.value=l,f()},L=async l=>{try{const i={channelId:l.user.userChannels[0].channelId},N={useYn:"isUsing",multiLoginYn:"isMultiLoginYn",mfaUseYn:"isMfaUseYn"};for(const ne of Object.entries(N)){const[Q,re]=ne;if(Q in l){i[re]=l[Q];break}}(await k(l.user.id,i)).success&&(window.Notify.success({message:Z.user.edit}),await f())}catch(i){console.error("AdminUserView: onChangeUseYn() Error ",i)}},J=S(()=>t.value?`${t.value.userNm}(${t.value.userId})`:""),ae=async()=>{try{(await P(t.value.id)).success&&(window.Notify.success({message:Z.user.delete}),await f())}catch(l){console.error("AdminUserView onDelete() Error ",l)}},z=S(()=>{var l,i;return`${(l=t.value)==null?void 0:l.userNm}(${(i=t.value)==null?void 0:i.userId})`}),le=S(()=>v("User.사용자를_복구하시겠습니까?")),Y=()=>{},E=async l=>{try{(await h(l)).success&&(window.Notify.success({message:Z.user.create}),await f(),y.value=!1)}catch(i){console.error("AdminUserView onCreateUser() Error",i)}},te=async l=>{try{(await k(t.value.id,l)).success&&(window.Notify.success({message:Z.user.edit}),await f(),y.value=!1)}catch(i){console.error("AdminUserView onCreateUser() Error",i)}},oe=l=>{l&&f(),y.value=!1};return ge(()=>{f()}),(l,i)=>{const N=Be("tooltip");return p(),M("div",_s,[r("div",ws,[r("div",bs,[r("div",Cs,[r("span",ys,w(u(v)("User.사용자")),1),r("span",Ys,w(u(v)("User.사용자수",{users:d.value.length})),1)]),g(W,{modelValue:e.value,"onUpdate:modelValue":i[0]||(i[0]=A=>e.value=A),width:"w-96",placeholder:u(v)("User.사용자_이름_또는_아이디로_검색하세요"),onKeyup:Oe(f,["enter"])},null,8,["modelValue","placeholder"]),g(B,{icon:"magnifying-glass",onClick:f}),r("div",Ms,[g(u(Te),{modelValue:_.value,"onUpdate:modelValue":i[1]||(i[1]=A=>_.value=A),name:"isDeletedUsers",label:u(v)("User.삭제된_사용자"),onChange:j},null,8,["modelValue","label"])])]),r("div",Vs,[K(g(B,{icon:"arrow-path",onClick:f},null,512),[[N,u(v)("User.새로고침")]]),_.value?K((p(),C(Pe,{key:0,icon:"recover",disabled:b.value||!t.value,title:z.value,html:le.value,onOnConfirm:Y},null,8,["disabled","title","html"])),[[N,u(v)("User.복구")]]):$("",!0),_.value?$("",!0):K((p(),C(B,{key:1,icon:"plus",disabled:b.value,onClick:O},null,8,["disabled"])),[[N,u(v)("User.추가")]]),_.value?$("",!0):K((p(),C(B,{key:2,icon:"pencil",disabled:b.value||!t.value,onClick:I},null,8,["disabled"])),[[N,u(v)("User.수정")]]),_.value?$("",!0):K((p(),C(Ae,{key:3,disabled:b.value||!t.value,title:J.value,onOnConfirm:ae},null,8,["disabled","title"])),[[N,u(v)("User.삭제")]])])]),r("div",Ns,[g(as,{"is-loading":b.value,"row-data":d.value,"page-info":R.value,onSelectedRows:X,onDoubleClickedRow:T,onOnToggleUse:L,onOnToggleMultiLogin:L,onOnToggleMfa:L},null,8,["is-loading","row-data","page-info"])]),y.value?(p(),C(xs,{key:0,"user-mng-id":t.value.id,mode:U.value,onOnCreate:E,onOnEdit:te,onClose:oe},null,8,["user-mng-id","mode"])):$("",!0)])}}});export{As as default};
