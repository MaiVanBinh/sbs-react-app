import{d as W,a5 as Z,k as N,l as Q,t as K,a as x,c as D,Y as e,G as a,a6 as ae,a0 as v,j as s,$ as E,K as S,w as U,X as M,a2 as j,ae as ve,aD as le,aa as fe,o as ie,ah as F,F as X,C as oe,af as ye,ak as se,a1 as q,h as R,av as Y,ag as J,u as _e,V as ge,an as P,ao as he,ap as Ce}from"./index-eLyz9_Ts.js";import{_ as be}from"./VDCEditor.vue_vue_type_script_setup_true_lang-IhnNo6sk.js";import{_ as ne}from"./GDatePicker.vue_vue_type_style_index_0_lang-aP5TJiAZ.js";import{_ as we}from"./AttachFile.vue_vue_type_script_setup_true_lang-4bXpMLKb.js";import{_ as xe}from"./Comment.vue_vue_type_script_setup_true_lang-4b5dYawy.js";import{F as Ve}from"./file-division-code-x51qUgaH.js";import{u as $e}from"./file-Gx0JxWZZ.js";import{_ as ke}from"./NoticeHeader.vue_vue_type_script_setup_true_lang-U6uA3q-H.js";import{_ as De}from"./ConfirmModal.vue_vue_type_script_setup_true_lang-k_ZxaDhN.js";import{_ as H}from"./ModalButton.vue_vue_type_script_setup_true_lang-WIw8hxFk.js";const Ne={class:"text-primary-gray-40 dark:text-white"},Ue={class:"flex items-center justify-start mb-4"},Se={class:"font-bold"},Ie={class:"grid grid-cols-12 gap-2 mb-3"},Oe={class:"col-span-2"},Ee={class:"flex flex-col col-span-9 gap-2"},Ae={class:"flex items-start gap-2"},Te={class:"text-black dark:text-white mt-1"},Ye={class:"flex items-center gap-2"},Le={class:"mr-1"},Me={key:0,class:"text-red-500 mt-1"},je={class:"flex items-center gap-2"},Re={class:"mr-1"},Fe={key:0,class:"text-red-500 mt-1"},Be={class:"grid grid-cols-12 gap-2 mb-3"},ze={class:"col-span-2"},Ge={class:"flex flex-col col-span-9 gap-2"},Pe={class:"flex items-start gap-2"},He={class:"text-black dark:text-white mt-1"},Je={class:"grid grid-cols-12 gap-2"},Ke={class:"flex flex-col col-span-3"},We=W({__name:"NoticeInformation",props:{noticeInfo:{}},emits:["update:noticeInfo"],setup(I,{emit:$}){const k=I,u=$,{t}=Z(),l=N(k.noticeInfo),i=Q(()=>{const b=!l.value.pinnedStartDate||!l.value.pinnedEndDate,d=l.value.pinnedStartDate===l.value.pinnedEndDate;return b||d?!0:ve(l.value.pinnedStartDate).isBefore(l.value.pinnedEndDate)}),C=(b,d)=>JSON.stringify(b)!==JSON.stringify(d);return K(()=>k.noticeInfo,b=>{C(l.value,b)&&(l.value=b)},{deep:!0}),K(()=>l.value,b=>{C(k.noticeInfo,b)&&u("update:noticeInfo",b)},{deep:!0}),(b,d)=>(x(),D("div",Ne,[e("div",Ue,[a(ae,{icon:"custom-chevron",size:"w-5 h-5",class:"mr-2"}),e("p",Se,v(s(t)("Community.상세정보")),1)]),e("div",Ie,[d[4]||(d[4]=e("div",{class:"col-span-1"},null,-1)),e("p",Oe,v(s(t)("Community.상단고정")),1),e("div",Ee,[e("div",Ae,[a(E,{"model-value":l.value.pinYn==="Y",name:"pinYn","onUpdate:modelValue":d[0]||(d[0]=w=>l.value.pinYn=w?"Y":"N")},null,8,["model-value"]),e("div",null,[e("p",null,v(s(t)("Community.상단고정 사용")),1),e("p",Te,v(s(t)("Community.상단고정은 최대 10개 까지 사용할 수 있습니다")),1)])]),e("div",Ye,[e("p",Le,v(s(t)("Community.상단고정시작")),1),e("div",null,[a(ne,{modelValue:l.value.pinnedStartDate,"onUpdate:modelValue":d[1]||(d[1]=w=>l.value.pinnedStartDate=w)},null,8,["modelValue"]),i.value?S("",!0):(x(),D("p",Me,v(s(t)("Community.올바른 날짜를 입력해주세요")),1))])]),e("div",je,[e("p",Re,v(s(t)("Community.상단고정종료")),1),e("div",null,[a(ne,{modelValue:l.value.pinnedEndDate,"onUpdate:modelValue":d[2]||(d[2]=w=>l.value.pinnedEndDate=w)},null,8,["modelValue"]),i.value?S("",!0):(x(),D("p",Fe,v(s(t)("Community.올바른 날짜를 입력해주세요")),1))])])])]),e("div",Be,[d[5]||(d[5]=e("div",{class:"col-span-1"},null,-1)),e("p",ze,v(s(t)("Community.긴급공지")),1),e("div",Ge,[e("div",Pe,[a(E,{"model-value":l.value.urgentYn==="Y",name:"urgentYn","onUpdate:modelValue":d[3]||(d[3]=w=>l.value.urgentYn=w?"Y":"N")},null,8,["model-value"]),e("div",null,[e("p",null,v(s(t)("Community.긴급공지 사용")),1),e("p",He,v(s(t)("Community.긴급공지 설정 시 사용자에게 Push 메시지가 전송됩니다")),1)])])])]),e("div",Je,[d[6]||(d[6]=e("p",{class:"col-span-3"},null,-1)),e("div",Ke,[a(j,{class:"!bg-dark-secondary text-white text-sm font-bold hover:!bg-primary"},{default:U(()=>[M(v(s(t)("Community.권한설정")),1)]),_:1})])])]))}}),Qe={class:"overflow-auto dark:!bg-dark-secondary h-[calc(100vh-250px)]"},Xe=W({__name:"NoticeComment",props:{comments:{},currentNoticeId:{},isLoadingComments:{type:Boolean}},emits:["on-refresh"],setup(I,{emit:$}){const k=$,u=I,t=le(),{getChDivId:l}=fe(),i=N(!1),C=Q(()=>u.comments),b=N([]),d=async(g,V)=>{(await t.community.notice.editComment(u.currentNoticeId,V,g)).success&&(k("on-refresh"),window.Notify.success({message:F.communityNotice.editComment}))},w=async g=>{(await t.community.notice.createComment(u.currentNoticeId,g)).success&&(k("on-refresh"),window.Notify.success({message:F.communityNotice.createComment}))},_=async()=>{k("on-refresh")},A=async g=>{(await t.community.notice.deleteComment(u.currentNoticeId,g)).success&&(k("on-refresh"),window.Notify.success({message:F.communityNotice.createComment}))},T=async(g,V,o,y)=>{if(!u.currentNoticeId||u.isLoadingComments||i.value)return;const r={userId:y,notiCmntId:g,isActive:V};if(V===o){r.isActive=null,i.value=!0;const f=await t.community.notice.cancelCommentLike(u.currentNoticeId,r);f!=null&&f.success&&_(),i.value=!1;return}i.value=!0;const h=await t.community.notice.likeComment(u.currentNoticeId,r);h!=null&&h.success&&_(),i.value=!1},O=async g=>{const V=C.value.find(o=>o.id===g);V&&(V.isReplying=!0)},m=async()=>{const g={chDivId:l,useYn:"Y",delYn:"N",size:1e4},V=await t.community.notice.getUsers(g);V.success&&(b.value=V.data.content.map(o=>({id:o.id,name:o.userNm})))};return ie(async()=>{await m()}),(g,V)=>(x(),D("div",Qe,[a(xe,{"user-list":b.value,"parent-id":g.currentNoticeId,"comment-list":C.value,onOnEdit:d,onOnSubmit:w,onOnRefresh:_,onOnDelete:A,onOnLikeComment:T,onOnReply:O},null,8,["user-list","parent-id","comment-list"])]))}}),qe={class:"overflow-y-auto h-[calc(100vh-310px)] mb-3"},Ze={class:"flex items-center justify-start mb-4"},et={class:"text-primary-gray-40 dark:text-white font-bold"},tt={class:"flex items-center justify-start mb-4"},ot={class:"mr-3"},st={key:0},nt={class:"pl-1 pr-3 pt-3 py-9"},at={class:"grid grid-cols-24 gap-2 mb-3 items-center"},lt={class:"col-span-4 text-right"},it=["onClick"],ct={class:"text-[9px]"},rt={class:"grid grid-cols-12 gap-2 mb-2 items-center"},dt={class:"col-span-2 text-right"},ut={class:"col-span-4 text-right"},mt={class:"grid grid-cols-12 gap-2 mb-4 items-center"},pt={class:"grid grid-cols-12 gap-2 items-center"},vt={class:"col-span-2 text-right"},ft={class:"col-span-3 flex items-center justify-center"},yt={class:"col-span-3 flex items-center justify-center"},_t={class:"col-span-4 flex items-center justify-center"},gt={class:"border-t border-primary-gray-999 pt-2 pb-2"},ht={class:"flex items-center justify-center"},Ct=W({__name:"NoticeVote",props:{vote:{},originalVote:{},isUseVote:{type:Boolean}},emits:["update:vote","update:isUseVote"],setup(I,{emit:$}){const k=$,u=o=>o.map(y=>({...y,rangeDate:[Y(y.voteStartDt),Y(y.voteEndDt)]})),{t}=Z(),l=I,i=N(u(l.vote||[])),C=N(l.isUseVote||!1),b=Q(()=>!C.value),d={voteTitl:"",allowAnonymous:!1,allowMultiple:!1,allowOptionAdd:!1,voteStartDt:"",voteEndDt:"",rangeDate:[],voteOptions:[],isSaved:!1},w=o=>{C.value=!o},_=o=>{i.value[o].voteStartDt=Y(i.value[o].rangeDate[0]),i.value[o].voteEndDt=Y(i.value[o].rangeDate[1])},A=o=>{if(i.value[o].isSaved=!1,l.vote&&l.originalVote&&l.originalVote[o]){const y=l.originalVote[o];i.value[o]={...y,rangeDate:[Y(y.voteStartDt),Y(y.voteEndDt)]};return}i.value[o]=J.cloneDeep(d)},T=(o,y)=>{i.value[o].voteOptions.splice(y,1)},O=o=>{i.value[o].voteOptions.push({voteOptCtt:""})},m=()=>{i.value.push(J.cloneDeep(d))},g=o=>{i.value.splice(o,1)},V=o=>{i.value[o].isSaved=!i.value[o].isSaved};return K(()=>C.value,o=>{o&&i.value.length===0&&(i.value=[J.cloneDeep(d)]),o||(i.value=[]),k("update:isUseVote",o)}),K(()=>i.value,o=>{k("update:vote",o)},{deep:!0}),(o,y)=>(x(),D(X,null,[e("div",qe,[e("div",Ze,[a(ae,{icon:"custom-chevron",size:"w-5 h-5",class:"mr-2"}),e("p",et,v(s(t)("Community.투표기능")),1)]),e("div",tt,[e("p",ot,v(s(t)("Community.투표기능 사용")),1),a(E,{id:"isUseVote",modelValue:C.value,"onUpdate:modelValue":y[0]||(y[0]=r=>C.value=r),class:"mr-3",name:"isUseVote",label:s(t)("Community.사용")},null,8,["modelValue","label"]),a(E,{id:"isNotUseVote","model-value":b.value,class:"mr-2",name:"isNotUseVote",label:s(t)("Community.미사용"),onChange:w},null,8,["model-value","label"]),y[1]||(y[1]=e("p",null,null,-1))]),C.value?(x(),D("div",st,[(x(!0),D(X,null,oe(i.value,(r,h)=>(x(),D("div",{key:h,class:"border border-primary-gray-999 p-1 mb-3"},[e("div",nt,[e("div",at,[e("p",lt,v(s(t)("Community.투표가능 일정")),1),a(ye,{modelValue:r.rangeDate,"onUpdate:modelValue":[f=>r.rangeDate=f,f=>_(h)],class:"col-span-15",clearable:!0,"text-input":!0,"custom-input-class":"!py-1",width:"w-full",teleport:"",disabled:r.isSaved},null,8,["modelValue","onUpdate:modelValue","disabled"]),y[2]||(y[2]=e("div",{class:"col-span-2"},null,-1)),e("div",{class:"col-span-3 flex flex-col items-center justify-center border border-gray-300 rounded-lg cursor-pointer hover:!border-primary",onClick:f=>A(h)},[a(se,{icon:"custom-refresh","icon-size":"w-4 h-4"}),e("p",ct,v(s(t)("Community.초기화")),1)],8,it)]),e("div",rt,[e("p",dt,v(s(t)("Community.제목")),1),a(q,{modelValue:r.voteTitl,"onUpdate:modelValue":f=>r.voteTitl=f,class:"col-span-10",disabled:r.isSaved,"custom-input-class":"!py-1"},null,8,["modelValue","onUpdate:modelValue","disabled"])]),(x(!0),D(X,null,oe(r.voteOptions,(f,L)=>(x(),D("div",{key:L,class:"grid grid-cols-24 gap-2 mb-2 items-center"},[e("p",ut,v(s(t)("Community.항목"))+" "+v(L+1),1),a(q,{modelValue:f.voteOptCtt,"onUpdate:modelValue":B=>f.voteOptCtt=B,class:"col-span-18","custom-input-class":"!py-1",disabled:r.isSaved},null,8,["modelValue","onUpdate:modelValue","disabled"]),a(se,{class:"col-span-2 !block",icon:"delete","icon-size":"w-8 h-8",disabled:r.isSaved,onClick:B=>T(h,L)},null,8,["disabled","onClick"])]))),128)),e("div",mt,[y[3]||(y[3]=e("p",{class:"col-span-2 text-right"},null,-1)),a(j,{class:"col-span-10 rounded-lg !bg-primary-gray-surface !text-primary-gray-50 !border-primary-gray-30 !py-1 hover:!border-primary",type:"secondary",disabled:r.isSaved,onClick:f=>O(h)},{default:U(()=>[M("+"+v(s(t)("Community.항목추가")),1)]),_:2},1032,["disabled","onClick"])]),e("div",pt,[e("p",vt,v(s(t)("Community.투표 옵션")),1),e("div",ft,[a(E,{id:`voteTypeAnonymous-${h}`,modelValue:r.allowAnonymous,"onUpdate:modelValue":f=>r.allowAnonymous=f,name:`voteTypeAnonymous-${h}`,label:s(t)("Community.익명투표"),disabled:r.isSaved},null,8,["id","modelValue","onUpdate:modelValue","name","label","disabled"])]),e("div",yt,[a(E,{id:`voteTypeMultiple-${h}`,modelValue:r.allowMultiple,"onUpdate:modelValue":f=>r.allowMultiple=f,name:`voteTypeMultiple-${h}`,label:s(t)("Community.복수선택"),disabled:r.isSaved},null,8,["id","modelValue","onUpdate:modelValue","name","label","disabled"])]),e("div",_t,[a(E,{id:`voteTypeAddItem-${h}`,modelValue:r.allowOptionAdd,"onUpdate:modelValue":f=>r.allowOptionAdd=f,name:`voteTypeAddItem-${h}`,label:s(t)("Community.선택항목추가 허용"),disabled:r.isSaved},null,8,["id","modelValue","onUpdate:modelValue","name","label","disabled"])])])]),e("div",gt,[e("div",ht,[a(j,{type:"warning",onClick:f=>g(h)},{default:U(()=>[M(v(s(t)("Community.삭제")),1)]),_:2},1032,["onClick"]),a(j,{class:"ml-auto",onClick:f=>V(h)},{default:U(()=>[M(v(r.isSaved?s(t)("Community.교정"):s(t)("Community.저장")),1)]),_:2},1032,["onClick"])])])]))),128))])):S("",!0)]),C.value?(x(),R(j,{key:0,class:"w-full rounded-lg !bg-primary-gray-surface !text-black font-bold !text-base !border-primary-gray-30 !py-1 hover:!border-primary",type:"secondary",onClick:m},{default:U(()=>[M("+"+v(s(t)("Community.투표항목추가")),1)]),_:1})):S("",!0)],64))}}),bt={class:"dark:text-white text-xs"},wt={class:"flex justify-between flex-grow h-full overflow-y-hidden flex-wrap pt-2"},xt={class:"flex flex-col w-[70%] p-2.5 border border-primary-gray-999 rounded-md h-[85vh]"},Vt={class:"flex items-center gap-2 mb-3"},$t={class:"w-[40px] text-right mr-2 font-bold text-primary-gray-40 dark:text-white"},kt={class:"flex-grow overflow-y-auto"},Dt={class:"flex flex-col w-[29.5%] py-2 px-1 border border-primary-gray-999 rounded-md h-[85vh]"},Nt={class:"px-11 h-[50px] border-t border-primary-gray-surface flex items-center justify-center"},Ut={key:0,class:"flex items-center justify-center gap-x-2 p-2 w-full"},St={key:1,class:"flex items-center justify-center gap-x-2 w-full"},Ft=W({__name:"NoticeCreateAndEdit",props:{id:{}},setup(I){const $=I,k=_e(),{t:u}=Z(),t={id:3,name:u("Community.코맨트")},l=[{id:1,name:u("Community.상세정보")},{id:2,name:u("Community.첨부파일")},t,{id:4,name:u("Community.투표")}],{fileUpload:i}=$e(),C=le(),{moveListCommunityNotice:b}=Ce(),d=N(),w=N([]),_=N({notiTitl:"",notiCtt:"",attcFiles:[],pinYn:"N",pinnedStartDate:"",pinnedEndDate:"",urgentYn:"N",accessUserDeptId:[],accessUserDeptNm:[],votes:[],isVote:!1}),A=N([]),T=N(null),O=N(!1),m=ge({isOpen:!1,title:"",content:"",type:"confirm",case:"confirm",icon:"exclamationCircle"}),g=Q(()=>!!$.id),V=c=>c.map(n=>({...n,name:n.fileNm,fileId:n.id})),o=c=>{const n=c;return!c.votes||c.votes.length===0||(n.votes=c.votes.map(p=>({...p,isSaved:!0}))),n},y=async c=>{try{const n=await C.community.notice.findOne(c);if(n.success){const p=o(n.data);_.value=p,w.value=V(n.data.attcFiles),A.value=J.cloneDeep(p.votes||[]),_.value.isVote=n.data.votes.length>0}}catch(n){console.log("Fail to get notice",n)}},r=async()=>{var p;if(!w.value)return[];const c=(p=w==null?void 0:w.value)==null?void 0:p.map(async G=>{if(G.type){const pe={fileName:G.name,fileDivisionCode:Ve.Board.id,publicYn:"Y",file:G},te=await i(pe);if(te.success)return te.data.id}else return G.id});return await Promise.all(c)},h=c=>{var p;const n=c.votes&&((p=c.votes)==null?void 0:p.length)>0;return{...c,isVote:n}},f=()=>{m.title="Information",m.isOpen=!0,m.content=u("Community.제목을 입력하여 주세요"),m.type="basic",m.case="check-title",m.icon="customInfo"},L=()=>{m.title="확인",m.isOpen=!0,m.content=g.value?`${u("Community.내용이 변경되었습니다")}.
${u("Community.저장하시겠습니까?")}`:u("Community.저장하시겠습니까?"),m.type="confirm",m.case=g.value?"edit":"create",m.icon="customQuestionMark"},B=()=>{T.value.onClose()},z=()=>{m.isOpen=!1},ce=async(c,n)=>{const p=await C.community.notice.updateNotice(c,h(n));p!=null&&p.success?(window.Notify.success({message:F.communityNotice.edit}),b(k,"Edit")):window.Notify.error({message:p.msg})},re=async c=>{const n=await C.community.notice.createNotice(h(c));n!=null&&n.success?(window.Notify.success({message:F.communityNotice.create}),b(k)):window.Notify.error({message:n.msg})},de=()=>{if(!_.value.notiTitl){f();return}L()},ue=async()=>{z();const c=await r(),n={..._.value,attcFileIds:c.length?c:[]};g.value&&$.id?ce($.id,n):re(n)},me=c=>{_.value={..._.value,...c}},ee=async()=>{try{if(O.value=!0,$.id){const c=await C.community.notice.getComments($.id);c.success&&(d.value=c.data)}}catch(c){console.log("Fail to get comment",c)}finally{O.value=!1}};return ie(()=>{$.id&&(y($.id),ee())}),(c,n)=>(x(),D("div",bt,[a(ke,{ref_key:"noticeHeaderRef",ref:T,"is-edit-and-create":!0,onOnSave:de},null,512),e("div",wt,[e("div",xt,[e("div",Vt,[e("p",$t,v(s(u)("Community.제목")),1),a(q,{modelValue:_.value.notiTitl,"onUpdate:modelValue":n[0]||(n[0]=p=>_.value.notiTitl=p),name:"title",class:"w-1/2","custom-input-class":"rounded-none"},null,8,["modelValue"])]),e("div",kt,[a(be,{content:_.value.notiCtt,"editor-class":"h-full","onUpdate:content":n[1]||(n[1]=p=>_.value.notiCtt=p)},null,8,["content"])])]),e("div",Dt,[e("div",null,[a(he,{"is-plain-text-mode":!0,"overflow-class":!0,tabs:g.value?l:l.filter(p=>p.id!==t.id),"is-compact-mode":!0,class:"justify-center space-y-3 rounded-xl"},{default:U(()=>[a(s(P),null,{default:U(()=>[a(We,{"notice-info":_.value,"onUpdate:noticeInfo":me},null,8,["notice-info"])]),_:1}),a(s(P),null,{default:U(()=>[a(we,{"file-list":w.value},null,8,["file-list"])]),_:1}),g.value?(x(),R(s(P),{key:0},{default:U(()=>[$.id?(x(),R(Xe,{key:0,comments:d.value,"current-notice-id":$.id,"is-loading-comments":O.value,onOnRefresh:ee},null,8,["comments","current-notice-id","is-loading-comments"])):S("",!0)]),_:1})):S("",!0),a(s(P),null,{default:U(()=>[a(Ct,{"is-use-vote":_.value.isVote,vote:_.value.votes,"original-vote":A.value,"onUpdate:vote":n[2]||(n[2]=p=>_.value.votes=p),"onUpdate:isUseVote":n[3]||(n[3]=p=>_.value.isVote=p)},null,8,["is-use-vote","vote","original-vote"])]),_:1})]),_:1},8,["tabs"])])])]),m.isOpen?(x(),R(De,{key:0,"use-slot":"",intent:"secondary",text:m.content,type:m.type,title:m.title,icon:m.icon,onClose:z},{bottom:U(()=>[e("div",Nt,[m.type==="basic"?(x(),D("div",Ut,[a(H,{text:"OK",icon:"check",onClick:z})])):S("",!0),m.type==="confirm"?(x(),D("div",St,[a(H,{text:s(u)("Community.예"),icon:"check",onClick:ue},null,8,["text"]),a(H,{type:"warning",text:s(u)("Community.아니요"),icon:"xMark",onClick:B},null,8,["text"]),m.case==="edit"?(x(),R(H,{key:0,type:"warning",text:s(u)("Community.취소"),icon:"xMark",onClick:z},null,8,["text"])):S("",!0)])):S("",!0)])]),_:1},8,["text","type","title","icon"])):S("",!0)]))}});export{Ft as _};
